BACKUP ~faiths_and_powers/backup~
AUTHOR ~SubtleD and Grammarsalad~


VERSION ~0.74.37~

//README ~faiths_and_powers/readme-pnp.html~


ALWAYS

	ACTION_IF NOT FILE_EXISTS ~override/d5_fnp_settings.ini~ BEGIN
  	  COPY ~faiths_and_powers/d5_fnp_settings.ini~ ~override~
	END
  	
  	INCLUDE ~override/d5_fnp_settings.ini~

	INCLUDE ~faiths_and_powers/lib/remove_lines.tpa~

	INCLUDE ~faiths_and_powers/lib/spell_to_innate.tpa~

	INCLUDE ~faiths_and_powers/lib/fl#add_kit_ee.tpa~

	INCLUDE ~faiths_and_powers/lib/spell_clone_effects.tpa~
	
	INCLUDE ~faiths_and_powers/lib/joinable_npcs.tpa~

	INCLUDE ~faiths_and_powers/lib/fnp_compat.tpa~
	
	INCLUDE ~faiths_and_powers/lib/qd_multiclass.tpa~

	ACTION_IF FILE_EXISTS_IN_GAME ~a#ooze.2da~ BEGIN
	  COPY_EXISTING ~alignmnt.2da~ ~override~
		REPLACE_TEXTUALLY ~DRUID.+$~ ~DRUID	0	1	0	1	1	1	0	1	0 ~
		REPLACE_TEXTUALLY ~FIGHTER_DRUID.+$~ ~FIGHTER_DRUID	0	1	0	1	1	1	0	1	0 ~
		REPLACE_TEXTUALLY ~TOTEMIC_DRUID.+$~ ~TOTEMIC_DRUID	0	1	0	1	1	1	0	1	0 ~
		REPLACE_TEXTUALLY ~SHAPESHIFTER.+$~ ~SHAPESHIFTER	0	1	0	1	1	1	0	1	0 ~
		REPLACE_TEXTUALLY ~BEAST_FRIEND.+$~ ~BEAST_FRIEND	0	1	0	1	1	1	0	1	0 ~
	END

	INCLUDE ~faiths_and_powers/lib/add_cleric_kits.tpa~
	INCLUDE ~faiths_and_powers/lib/add_acolyte_kits.tpa~
	INCLUDE ~faiths_and_powers/lib/add_druid_kits.tpa~
	INCLUDE ~faiths_and_powers/lib/add_mystic_kits.tpa~
	INCLUDE ~faiths_and_powers/lib/add_occultist_kits.tpa~
	INCLUDE ~faiths_and_powers/lib/add_ranger_kits.tpa~
	INCLUDE ~faiths_and_powers/lib/add_scout_kits.tpa~
	INCLUDE ~faiths_and_powers/lib/add_champion_kits.tpa~
	INCLUDE ~faiths_and_powers/lib/add_zealot_kits.tpa~
	INCLUDE ~faiths_and_powers/lib/add_multiclass_kits.tpa~

// joinable NPC issues for tutu/bgt/eet:
  ACTION_IF GAME_IS ~bgee~ BEGIN
    OUTER_SPRINT tutu_var ~~
    OUTER_SPRINT imoen6_var ~imoen6~
    OUTER_SPRINT jaheir7_var ~jaheir7~
    OUTER_SPRINT minsc7_var ~minsc7~
    OUTER_SPRINT quayle_var ~quayle~
    OUTER_SPRINT viconi6_var ~viconi6~
    OUTER_SPRINT xan_var ~xan~
    OUTER_SPRINT xzar_var ~xzar~
  END ELSE ACTION_IF GAME_IS ~eet~ BEGIN
    OUTER_SPRINT tutu_var ~~
    OUTER_SPRINT imoen6_var ~imoen6_~
    OUTER_SPRINT jaheir7_var ~jaheir7_~
    OUTER_SPRINT minsc7_var ~minsc7_~
    OUTER_SPRINT quayle_var ~quayle_~
    OUTER_SPRINT viconi6_var ~viconi6_~
    OUTER_SPRINT xan_var ~xan_~
    OUTER_SPRINT xzar_var ~xzar_~
  END ELSE ACTION_IF GAME_IS ~bgt~ BEGIN
    OUTER_SPRINT tutu_var ~~
    OUTER_SPRINT imoen6_var ~imoen61~
    OUTER_SPRINT quayle_var ~bgquayle~
    OUTER_SPRINT viconi6_var ~viconi61~
    OUTER_SPRINT xan_var ~bgxan~
    OUTER_SPRINT xzar_var ~bgxzar~
  END ELSE ACTION_IF GAME_IS ~tutu tutu_totsc~ BEGIN
    OUTER_SPRINT tutu_var ~_~
    OUTER_SPRINT imoen6_var ~imoen6~
    OUTER_SPRINT quayle_var ~quayle~
    OUTER_SPRINT viconi6_var ~viconi6~
    OUTER_SPRINT xan_var ~xan~
    OUTER_SPRINT xzar_var ~xzar~
  END

END

// ASK_EVERY_COMPONENT

LANGUAGE
  ~English~
  ~english~
  ~faiths_and_powers/language/english/setup.tra~
//___________________________________________________________________________________




//__________________________________________________________________________________
//__________________________________________________________________________________
//
//					CHOOSE WHETHER/HOW TO INSTALL NEW KITS
//__________________________________________________________________________________
//__________________________________________________________________________________

//__________________________________________________________________________________
//__________________________________________________________________________________
//
//					EVERYTHING, USING DEITY SELECTION DIALOGUE
//__________________________________________________________________________________
//__________________________________________________________________________________

BEGIN @101
DESIGNATED 101
DEPRECATED @18


//__________________________________________________________________________________
//__________________________________________________________________________________
//
//					102: ALL KITS + SPHERE SYSTEM; KITS IN MENUS
//__________________________________________________________________________________
//__________________________________________________________________________________

BEGIN @102 // all the new kits, and kits in menus
DESIGNATED 102
SUBCOMPONENT @100 /*(GAME_IS ~bgee bg2ee eet~)*/
//Acolyte Lore (added to clabs)
COPY ~faiths_and_powers/kits/acolytes/B_LOR.spl~ ~override~

//copy marker files_________________________________________________________________
//
COPY ~faiths_and_powers/lib/markers/d5_menu.d5~ ~override~
COPY ~faiths_and_powers/lib/markers/d5_deity.d5~ ~override~
COPY ~faiths_and_powers/lib/markers/d5_clerics.d5~ ~override~
COPY ~faiths_and_powers/lib/markers/d5_druids.d5~ ~override~
COPY ~faiths_and_powers/lib/markers/d5_paladins.d5~ ~override~
COPY ~faiths_and_powers/lib/markers/d5_rangers.d5~ ~override~
//__________________________________________________________________________________

//multiclass text____________________________________________________________________
//
ACTION_IF (FILE_EXISTS_IN_GAME ~clastext.2da~) BEGIN
  	COPY_EXISTING ~clastext.2da~ ~override~
		COUNT_2DA_COLS cols // amount of columns
		READ_2DA_ENTRIES_NOW rows cols // read all file into memory  
		FOR (row = 1; row < rows; ++row) BEGIN // iterate over rows
		  READ_2DA_ENTRY_FORMER rows row 0 ~text~ // read column value
		  PATCH_IF ~%text%~ STRING_EQUAL_CASE ~CLERIC~ BEGIN
		    SET c_row = %row%
		  END
		  PATCH_IF ~%text%~ STRING_EQUAL_CASE ~FIGHTER_CLERIC~ BEGIN
		    SET fc_row = %row%
		  END
		  PATCH_IF ~%text%~ STRING_EQUAL_CASE ~CLERIC_MAGE~ BEGIN
		    SET cm_row = %row%
		  END
		  PATCH_IF ~%text%~ STRING_EQUAL_CASE ~CLERIC_THIEF~ BEGIN
		    SET ct_row = %row%
		  END
		  PATCH_IF ~%text%~ STRING_EQUAL_CASE ~CLERIC_RANGER~ BEGIN
		    SET cr_row = %row%
		  END
		  PATCH_IF ~%text%~ STRING_EQUAL_CASE ~FIGHTER_DRUID~ BEGIN
		    SET fd_row = %row%
		  END
		END
		SET_2DA_ENTRY %c_row% 3 cols RESOLVE_STR_REF (@10001)
		SET_2DA_ENTRY %c_row% 5 cols RESOLVE_STR_REF (@10002)
		SET_2DA_ENTRY %c_row% 4 cols RESOLVE_STR_REF (@10005)
		SET_2DA_ENTRY %fc_row% 3 cols RESOLVE_STR_REF (@10011)
		SET_2DA_ENTRY %fc_row% 5 cols RESOLVE_STR_REF (@10012)
		SET_2DA_ENTRY %fc_row% 4 cols RESOLVE_STR_REF (@10015)
		SET_2DA_ENTRY %cm_row% 3 cols RESOLVE_STR_REF (@10021)
		SET_2DA_ENTRY %cm_row% 5 cols RESOLVE_STR_REF (@10022)
		SET_2DA_ENTRY %cm_row% 4 cols RESOLVE_STR_REF (@10025)
		SET_2DA_ENTRY %ct_row% 3 cols RESOLVE_STR_REF (@10031)
		SET_2DA_ENTRY %ct_row% 5 cols RESOLVE_STR_REF (@10032)
		SET_2DA_ENTRY %ct_row% 4 cols RESOLVE_STR_REF (@10035)
		SET_2DA_ENTRY %cr_row% 3 cols RESOLVE_STR_REF (@10041)
		SET_2DA_ENTRY %cr_row% 5 cols RESOLVE_STR_REF (@10042)
		SET_2DA_ENTRY %cr_row% 4 cols RESOLVE_STR_REF (@10045)
		SET_2DA_ENTRY %fd_row% 3 cols RESOLVE_STR_REF (@10051)
		SET_2DA_ENTRY %fd_row% 5 cols RESOLVE_STR_REF (@10052)
		SET_2DA_ENTRY %fd_row% 4 cols RESOLVE_STR_REF (@10055)
  	BUT_ONLY
END
ACTION_IF (FILE_EXISTS_IN_GAME ~sodcltxt.2da~) BEGIN
  	COPY_EXISTING ~sodcltxt.2da~ ~override~
		COUNT_2DA_COLS cols // amount of columns
		READ_2DA_ENTRIES_NOW rows cols // read all file into memory  
		FOR (row = 1; row < rows; ++row) BEGIN // iterate over rows
		  READ_2DA_ENTRY_FORMER rows row 0 ~text~ // read column value
		  PATCH_IF ~%text%~ STRING_EQUAL_CASE ~CLERIC~ BEGIN
		    SET c_row = %row%
		  END
		  PATCH_IF ~%text%~ STRING_EQUAL_CASE ~FIGHTER_CLERIC~ BEGIN
		    SET fc_row = %row%
		  END
		  PATCH_IF ~%text%~ STRING_EQUAL_CASE ~CLERIC_MAGE~ BEGIN
		    SET cm_row = %row%
		  END
		  PATCH_IF ~%text%~ STRING_EQUAL_CASE ~CLERIC_THIEF~ BEGIN
		    SET ct_row = %row%
		  END
		  PATCH_IF ~%text%~ STRING_EQUAL_CASE ~CLERIC_RANGER~ BEGIN
		    SET cr_row = %row%
		  END
		  PATCH_IF ~%text%~ STRING_EQUAL_CASE ~FIGHTER_DRUID~ BEGIN
		    SET fd_row = %row%
		  END
		END
		SET_2DA_ENTRY %c_row% 3 cols RESOLVE_STR_REF (@10001)
		SET_2DA_ENTRY %c_row% 5 cols RESOLVE_STR_REF (@10002)
		SET_2DA_ENTRY %c_row% 4 cols RESOLVE_STR_REF (@10005)
		SET_2DA_ENTRY %fc_row% 3 cols RESOLVE_STR_REF (@10011)
		SET_2DA_ENTRY %fc_row% 5 cols RESOLVE_STR_REF (@10012)
		SET_2DA_ENTRY %fc_row% 4 cols RESOLVE_STR_REF (@10015)
		SET_2DA_ENTRY %cm_row% 3 cols RESOLVE_STR_REF (@10021)
		SET_2DA_ENTRY %cm_row% 5 cols RESOLVE_STR_REF (@10022)
		SET_2DA_ENTRY %cm_row% 4 cols RESOLVE_STR_REF (@10025)
		SET_2DA_ENTRY %ct_row% 3 cols RESOLVE_STR_REF (@10031)
		SET_2DA_ENTRY %ct_row% 5 cols RESOLVE_STR_REF (@10032)
		SET_2DA_ENTRY %ct_row% 4 cols RESOLVE_STR_REF (@10035)
		SET_2DA_ENTRY %cr_row% 3 cols RESOLVE_STR_REF (@10041)
		SET_2DA_ENTRY %cr_row% 5 cols RESOLVE_STR_REF (@10042)
		SET_2DA_ENTRY %cr_row% 4 cols RESOLVE_STR_REF (@10045)
		SET_2DA_ENTRY %fd_row% 3 cols RESOLVE_STR_REF (@10051)
		SET_2DA_ENTRY %fd_row% 5 cols RESOLVE_STR_REF (@10052)
		SET_2DA_ENTRY %fd_row% 4 cols RESOLVE_STR_REF (@10055)
  	BUT_ONLY
END
//__________________________________________________________________________________

//enable lots of multiclasses_______________________________________________________
//
ACTION_IF FILE_EXISTS_IN_GAME ~CLSRCREQ.2da~ BEGIN
 COPY_EXISTING ~clsrcreq.2da~ ~override~
  COUNT_2DA_ROWS 8 rows
  FOR (row = 0 ; row < rows ; ++row) BEGIN
    READ_2DA_ENTRY row 0 8 entry
    PATCH_IF (("%entry%" STRING_COMPARE_CASE "FIGHTER_CLERIC"      = 0) OR
              ("%entry%" STRING_COMPARE_CASE "CLERIC_THIEF"        = 0)) BEGIN // cleric/thief, fighter/cleric
      SET_2DA_ENTRY  row 1 8 1
      SET_2DA_ENTRY  row 2 8 1
      SET_2DA_ENTRY  row 3 8 1
      SET_2DA_ENTRY  row 4 8 1
      SET_2DA_ENTRY  row 5 8 1
      SET_2DA_ENTRY  row 6 8 1
      SET_2DA_ENTRY  row 7 8 1
    END
    PATCH_IF ("%entry%" STRING_COMPARE_CASE "CLERIC_MAGE"         = 0) BEGIN // cleric/mage
      SET_2DA_ENTRY  row 1 8 1
      SET_2DA_ENTRY  row 2 8 1
      SET_2DA_ENTRY  row 3 8 1
      SET_2DA_ENTRY  row 6 8 1
    END
    PATCH_IF ("%entry%" STRING_COMPARE_CASE "CLERIC_RANGER"       = 0) BEGIN // cleric/ranger
      SET_2DA_ENTRY  row 1 8 1
      SET_2DA_ENTRY  row 2 8 1
      SET_2DA_ENTRY  row 3 8 1
    END
    PATCH_IF (("%entry%" STRING_COMPARE_CASE "FIGHTER_MAGE"        = 0) OR
              ("%entry%" STRING_COMPARE_CASE "FIGHTER_THIEF"       = 0) OR
              ("%entry%" STRING_COMPARE_CASE "FIGHTER_MAGE_THIEF"  = 0) OR
              ("%entry%" STRING_COMPARE_CASE "MAGE_THIEF"          = 0)) BEGIN // other human multiclasses
      SET_2DA_ENTRY  row 1 8 1
    END
    PATCH_IF (("%entry%" STRING_COMPARE_CASE "DRUID"               = 0) OR
    		  ("%entry%" STRING_COMPARE_CASE "FIGHTER_DRUID"       = 0)) BEGIN // druids and mystics
      SET_2DA_ENTRY  row 1 8 1
      SET_2DA_ENTRY  row 2 8 1
      SET_2DA_ENTRY  row 3 8 1
      SET_2DA_ENTRY  row 4 8 1
      SET_2DA_ENTRY  row 5 8 1
      SET_2DA_ENTRY  row 6 8 1
      SET_2DA_ENTRY  row 7 8 1
    END
    PATCH_IF ("%entry%" STRING_COMPARE_CASE "FIGHTER_MAGE_CLERIC" = 0) BEGIN // fighter/mage/cleric
      SET_2DA_ENTRY  row 1 8 0
      SET_2DA_ENTRY  row 2 8 0
      SET_2DA_ENTRY  row 3 8 0
      SET_2DA_ENTRY  row 4 8 0
      SET_2DA_ENTRY  row 5 8 0
      SET_2DA_ENTRY  row 6 8 0
      SET_2DA_ENTRY  row 7 8 0
    END
  END
  PRETTY_PRINT_2DA
 BUT_ONLY
END
//___________________________________________________________________________________

//install all the kits:_____________________________________________________________
//
// (clerics)
ACTION_IF (%d5_install_clerics% = 1) BEGIN
 LAM cleric_lathander
 LAM cleric_torm
 LAM cleric_tymora
 LAM cleric_helm
 ACTION_IF NOT GAME_IS ~iwdee~ BEGIN
  LAM cleric_kelemvor
 END
 LAM cleric_tempus
 LAM cleric_leira
 LAM cleric_baravar
 LAM cleric_loviatar
 LAM cleric_talos
 ACTION_IF NOT GAME_IS ~iwdee~ BEGIN
  LAM cleric_cyric
 END
 LAM cleric_umberlee
END
//
// (acolytes)
ACTION_IF (%d5_install_acolytes% = 1) BEGIN
 LAM acolyte_ilmater
 LAM acolyte_deneir
 LAM acolyte_sune
 LAM acolyte_tempus
// LAM acolyte_mystra
 LAM acolyte_mask
 LAM acolyte_shar
 LAM acolyte_moander
 LAM acolyte_beshaba
 LAM acolyte_baervan
END
//
// (druids)
ACTION_IF (%d5_install_druids% = 1) BEGIN
 LAM forest_druid
 LAM mountain_druid
 LAM jungle_druid
 LAM desert_druid
 LAM arctic_druid
END
//
// (mystics)
ACTION_IF (%d5_install_mystics% = 1) BEGIN
 LAM earth_mystic
 LAM water_mystic
 LAM air_mystic
 LAM fire_mystic
 LAM light_mystic
 LAM shadow_mystic
END
//
// (occultists)
ACTION_IF (%d5_install_occultists% = 1) BEGIN
 LAM beast_lord
 LAM elementalist
END
//
// (paladins)
ACTION_IF (%d5_install_champions% = 1) BEGIN
 //any race can have their pallys
 COPY_EXISTING ~clsrcreq.2da~ ~override~ //Testing...
 //pally
    SET_2DA_ENTRY 29 2 8 1
    SET_2DA_ENTRY 29 3 8 1
    SET_2DA_ENTRY 29 4 8 1
    SET_2DA_ENTRY 29 5 8 1
    SET_2DA_ENTRY 29 6 8 1
    SET_2DA_ENTRY 29 7 8 1
 //b guard
    SET_2DA_ENTRY 33 2 8 1
    SET_2DA_ENTRY 33 3 8 1
    SET_2DA_ENTRY 33 4 8 1
    SET_2DA_ENTRY 33 5 8 1
    SET_2DA_ENTRY 33 6 8 1
    SET_2DA_ENTRY 33 7 8 1
 BUT_ONLY_IF_IT_CHANGES
 //Dwarves need to be able to take the champion class.  Cha 13 requirement
 COPY_EXISTING ~ABCLASRQ.2da~ ~override~ //
 //Pally
    SET_2DA_ENTRY 6 6 6 13
    SET_2DA_ENTRY 30 6 6 13
    SET_2DA_ENTRY 31 6 6 13
    SET_2DA_ENTRY 32 6 6 13
 BUT_ONLY_IF_IT_CHANGES

 LAM champion_tyr
 LAM champion_azuth		//azuth essentially replaces Inquisitor
 LAM champion_moradin
 //champ of Kele effectively replaces UHunter. In IWDEE, the champ of mykrul is merely added (they're different enough conceptually to be seperate)
 ACTION_IF GAME_IS ~iwdee~ THEN BEGIN   //
  LAM iwdee_champion_kelemvor
 END
 //kelevmore undead hunter for non-iwdee
 ACTION_IF GAME_IS ~bgee bg2ee eet~ THEN BEGIN   //
  LAM champion_kelemvor
 END
 ACTION_IF FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No feasible way to make them not fall in IWDEE as yet
  LAM champion_tempus
 END
 ACTION_IF FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No Evil nonfallable pallys in IWDEE as yet
  LAM champion_bane
 END
 ACTION_IF NOT FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No Evil nonfallable pallys in IWDEE as yet
  LAM iwdee_champion_bane
 END
 ACTION_IF FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No Evil nonfallable pallys in IWDEE as yet
  LAM champion_helm
 END
 ACTION_IF NOT FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No Evil fallable pallys in IWDEE
  LAM iwdee_champion_helm
 END
 ACTION_IF FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No Evil nonfallable pallys in IWDEE
  LAM champion_talos
 END
 ACTION_IF NOT FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No Evil nonfallable pallys in IWDEE
  LAM iwdee_champion_talos
 END
 ACTION_IF FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No feasible way to make them not fall in IWDEE without fallen.2da
  LAM champion_red
 END
END
//
// (other paladins)
//
// (zealot)
ACTION_IF (%d5_install_zealots% = 1) BEGIN
 //sneaky sneaky
 COPY ~faiths_and_powers/kits/zealots/b_sneak.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk02.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk03.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk04.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk05.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk06.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk07.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk08.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk09.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk10.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk11.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk12.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk13.spl~ ~override~

 LAM zealot_ilmater
 LAM zealot_corellon
 LAM zealot_sune
 LAM zealot_mystra
 LAM zealot_eilistraee
 ACTION_IF FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No feasible way to make them not fall in IWDEE w/o fallen.2da
  LAM zealot_gruumsh
  LAM zealot_talos
  LAM zealot_kossuth
  LAM zealot_garagos
 END  //End grummsh/talos/kossuth/garagos
END
//
// (rangers)
ACTION_IF (%d5_install_rangers% = 1) BEGIN
 LAM forest_ranger
 LAM mountain_ranger
 LAM jungle_ranger
 LAM desert_ranger
 LAM arctic_ranger
 LAM beast_master
END
//
// (scouts)
ACTION_IF (%d5_install_scouts% = 1) BEGIN
 LAM mage_hunter
 LAM barbarian_ranger
 LAM elven_archer
 LAM halfling_slinger
END
//
// (multiclass)
ACTION_IF (%d5_install_multiclass% = 1) BEGIN
 LAM fighter_druid
 LAM druid_mage
 LAM druid_thief
 LAM druid_ranger
 LAM cm_mystra
 LAM cm_azuth
 LAM cm_bender
 LAM cf_clangeddin
 LAM cr_mielikki
 LAM cr_shaundakul
 LAM cf_helm
END
//
//__________________________________________________________________________________

//vanilla kits______________________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/vanilla_kit_spheres.tpa~
//__________________________________________________________________________________

//mod kits__________________________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/mod_kit_spheres.tpa~
//__________________________________________________________________________________

//default access____________________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/default_kit_spheres.tpa~
//__________________________________________________________________________________

//special kit: ur-priest
LAM cleric_ur_priest
//__________________________________________________________________________________

//Base kits_________________________________________________________________________
//
INCLUDE ~faiths_and_powers/kits/acolytes/acolyte.tpa~
INCLUDE ~faiths_and_powers/kits/champions/champion.tpa~
INCLUDE ~faiths_and_powers/kits/zealots/zealot.tpa~
//__________________________________________________________________________________

//remove unwanted kits from menus_______________________________________________****
//
COPY_EXISTING ~kitlist.2da~ ~override~
	COUNT_2DA_COLS k_cols // amount of columns
	READ_2DA_ENTRIES_NOW k_rows k_cols // read all file into memory  
	FOR (k_row = 1; k_row < k_rows; ++k_row) BEGIN // iterate over rows
	  READ_2DA_ENTRY_FORMER k_rows k_row 1 ~k_kit~ // read column value
	  PATCH_IF ~%k_kit%~ STRING_EQUAL_CASE ~B_ACOLYTE~ BEGIN
	    READ_2DA_ENTRY_FORMER k_rows k_row 0 acolyte_num
	  END
	  PATCH_IF ~%k_kit%~ STRING_EQUAL_CASE ~B_ZEALOT_1~ BEGIN
	    READ_2DA_ENTRY_FORMER k_rows k_row 0 zealot_num
	  END
	END
BUT_ONLY

ACTION_FOR_EACH class IN ~C~ ~D~ ~P~ ~R~ ~FC~ ~FD~ ~CM~ ~CT~ ~CR~ BEGIN
  ACTION_FOR_EACH race IN ~D~ ~E~ ~G~ ~H~ ~HE~ ~HL~ ~HO~ BEGIN
	ACTION_IF FILE_EXISTS_IN_GAME ~K_%class%_%race%.2da~ BEGIN
	  COPY_EXISTING ~K_%class%_%race%.2da~ ~override~
		COUNT_2DA_COLS cols
		READ_2DA_ENTRIES_NOW rows cols
		SET rows_removed = 0
		FOR (row = 1; row < rows; ++row) BEGIN
		  READ_2DA_ENTRY_FORMER rows row 1 kit
		  PATCH_IF (%kit% = 0) OR 
		  			(%kit% = 16) OR 
		  			(%kit% = 17) OR 
		  			(%kit% = 18) OR 
		  			(%kit% = 19) OR 
		  			(%kit% = 20) OR 
		  			(%kit% = 21) OR 
		  			(%kit% = 4) OR 
		  			(%kit% = 5) OR 
		  			(%kit% = 6) OR 
		  			(%kit% = acolyte_num) OR 
		  			(%kit% = zealot_num) BEGIN
			REMOVE_2DA_ROW (row - rows_removed) cols
			SET rows_removed += 1
		  END
		END
	  BUT_ONLY
	END
  END
END
//__________________________________________________________________________________

//halfling rangers__________________________________________________________________
//
COPY_EXISTING ~kitlist.2da~ ~override~
	COUNT_2DA_COLS cols // amount of columns
	READ_2DA_ENTRIES_NOW rows cols // read all file into memory  
	FOR (row = 1; row < rows; ++row) BEGIN // iterate over rows
	  READ_2DA_ENTRY_FORMER rows row 1 ~sling~ // read column value
	  PATCH_IF ~%sling%~ STRING_EQUAL_CASE ~D5SLING~ BEGIN
	    SET sling_row = (%row% + 1)
	  END
	END
  BUT_ONLY
COPY ~faiths_and_powers/kits/K_X_Y/K_R_HL.2da~ ~override~
	REPLACE_TEXTUALLY ~[ %TAB%]0~ ~%TAB%%sling_row%~
//__________________________________________________________________________________

//read fnp_compat info______________________________________________________________
//
LAM ~READ_FNP_KIT_INFO~
//__________________________________________________________________________________

//more scout alignments_____________________________________________________________
//
/*
ACTION_PHP_EACH d5_fnp_kits AS ind => kit BEGIN
  ACTION_IF (VARIABLE_IS_SET $d5_fnp_kit_class_access(~%kit%~)) BEGIN
	OUTER_TEXT_SPRINT class $d5_fnp_kit_class_access(~%kit%~)
	ACTION_IF (~%class%~ STRING_EQUAL_CASE ~SCOUT~) BEGIN
*/
ACTION_PHP_EACH d5_fnp_kit_class_access AS kit => class BEGIN
  ACTION_IF (~%class%~ STRING_EQUAL_CASE ~SCOUT~) BEGIN
	COPY_EXISTING ~kitlist.2da~ ~override~
	  COUNT_2DA_COLS cols // amount of columns
	  READ_2DA_ENTRIES_NOW rows cols // read all file into memory  
	  FOR (row = 7; row < rows; ++row) BEGIN // iterate over rows
		READ_2DA_ENTRY_FORMER rows row 5 ~clab~ // read column value
		PATCH_IF ~%clab%~ STRING_EQUAL_CASE ~%kit%~ BEGIN
		  SET kit_index = %row%
		  READ_2DA_ENTRY_FORMER rows kit_index 1 kit_label
		END
	  END
	BUT_ONLY
	APPEND ~fallen.2da~ ~%kit_label%%TAB%0~
	COPY_EXISTING ~alignmnt.2da~ ~override~
	  COUNT_2DA_COLS num_cols
	  READ_2DA_ENTRIES_NOW ~r2en_align~ num_cols
	  FOR (row = 3; row < r2en_align; row += 1) BEGIN
		READ_2DA_ENTRY_FORMER ~r2en_align~ row 0 align_name
		PATCH_IF (~%align_name%~ STRING_EQUAL_CASE ~%kit_label%~) BEGIN
		  FOR (col = 1; col < num_cols; col += 1) BEGIN
			SET_2DA_ENTRY_LATER ~s2el_align~ row col 1 // more alignments
		  END
		END
	  END
	  SET_2DA_ENTRIES_NOW ~s2el_align~ num_cols
	BUT_ONLY
  END
END
//__________________________________________________________________________________

//deity selection___________________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/deity_selection.tpa~
//__________________________________________________________________________________

//alter item usability______________________________________________________________
//
LAM d5_item_usability

ACTION_IF (%d5_item_use% = 1) BEGIN
  INCLUDE ~faiths_and_powers/lib/item_usability.tpa~
END
//__________________________________________________________________________________

//Add IWD spells if not already in game
ACTION_IF GAME_IS ~bgee bg2ee eet~ BEGIN
 ACTION_IF NOT MOD_IS_INSTALLED ~setup-iwdification.tp2~ ~40~ BEGIN  //If IWDification not installed...
  ACTION_IF NOT FILE_EXISTS_IN_GAME ~b_IWD.itm~ BEGIN    			//If b_ IWD spells not installed...
	COPY ~faiths_and_powers/compatibility/b_IWD.itm~ ~override~   	//to detect this component 
	INCLUDE ~faiths_and_powers/lib/Setup_IWD_divine_Spells.tpa~    	//install them
  END
 END
END

//Sphere System_____________________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/sphere_system.tpa~
//__________________________________________________________________________________

//Handle NPCs_______________________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/npc_kits.tpa~
//__________________________________________________________________________________

//no dual-classing__________________________________________________________________
//
LAM d5_dual_classing

ACTION_IF (%d5_dual_class% = 0) BEGIN
  COPY_EXISTING ~dualclas.2da~ ~override~
	COUNT_2DA_COLS cols
	COUNT_2DA_ROWS cols rows
	FOR (row = 0; row < (rows - 1); ++row) BEGIN
	  SET_2DA_ENTRY row 2 cols 0
	  SET_2DA_ENTRY row 6 cols 0
	END
	PRETTY_PRINT_2DA
  BUT_ONLY
END
//__________________________________________________________________________________





//__________________________________________________________________________________
//__________________________________________________________________________________
//
//						103: CHOOSE COMPONENTS INDIVIDUALLY
//__________________________________________________________________________________
//__________________________________________________________________________________

BEGIN @103 // kits in menus, choose kits individually
DESIGNATED 103
SUBCOMPONENT @100
//Acolyte Lore (added to clabs)
COPY ~faiths_and_powers/kits/acolytes/B_LOR.spl~ ~override~

//copy marker file__________________________________________________________________
//
COPY ~faiths_and_powers/lib/markers/d5_menu.d5~ ~override~
//__________________________________________________________________________________

//verbiage__________________________________________________________________________
//
PRINT ~without the dialogue system, kits are chosen from the menus~
PRINT ~therefore, we'll let the player to choose which ones to install~
//__________________________________________________________________________________




//__________________________________________________________________________________
//__________________________________________________________________________________
//
//						 105: NO KITS, JUST SPHERE SYSTEM
//__________________________________________________________________________________
//__________________________________________________________________________________


//__________________________________________________________________________________
BEGIN @105 // no deity selection or new kits
DESIGNATED 105
SUBCOMPONENT @100

//copy marker file__________________________________________________________________
//
COPY ~faiths_and_powers/lib/markers/d5_nada.d5~ ~override~
//__________________________________________________________________________________

//vanilla kits_______________________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/vanilla_kit_spheres.tpa~
//___________________________________________________________________________________

//mod kits___________________________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/mod_kit_spheres.tpa~
//___________________________________________________________________________________

//default access_____________________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/default_kit_spheres.tpa~
//___________________________________________________________________________________

//read fnp_compat info______________________________________________________________
//
LAM ~READ_FNP_KIT_INFO~
//__________________________________________________________________________________

//deity selection___________________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/deity_selection.tpa~
//__________________________________________________________________________________

//alter item usability______________________________________________________________
//
LAM d5_item_usability

ACTION_IF (%d5_item_use% = 1) BEGIN
  INCLUDE ~faiths_and_powers/lib/item_usability.tpa~
END
//__________________________________________________________________________________

//Add IWD spells if not already in game
ACTION_IF GAME_IS ~bgee bg2ee eet~ BEGIN
 ACTION_IF NOT MOD_IS_INSTALLED ~setup-iwdification.tp2~ ~40~ BEGIN  //If IWDification not installed...
  ACTION_IF NOT FILE_EXISTS_IN_GAME ~b_IWD.itm~ BEGIN    			//If b_ IWD spells not installed...
	COPY ~faiths_and_powers/compatibility/b_IWD.itm~ ~override~   	//to detect this component 
	INCLUDE ~faiths_and_powers/lib/Setup_IWD_divine_Spells.tpa~    	//install them
  END
 END
END

//run the sphere system______________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/sphere_system.tpa~
//__________________________________________________________________________________

//Handle NPCs_______________________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/npc_kits.tpa~
//__________________________________________________________________________________

//verbiage__________________________________________________________________________
//
PRINT ~neither the dialogue system nor any new kits will be installed~
PRINT ~the sphere system will be installed over the vanilla kits and/or previously installed mod kits~
//__________________________________________________________________________________





//__________________________________________________________________________________
//__________________________________________________________________________________
//
//					CHOOSE INDIVIDUAL CLERIC KITS
//__________________________________________________________________________________
//__________________________________________________________________________________

BEGIN @200 // install new cleric kits in place of vanilla ones
DESIGNATED 200
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~103~ @8

//copy marker file__________________________________________________________________
//
COPY ~faiths_and_powers/lib/markers/d5_clerics.d5~ ~override~
//__________________________________________________________________________________

//multiclasses_______________________________________________________________________
//
ACTION_IF FILE_EXISTS_IN_GAME ~CLSRCREQ.2da~ BEGIN
 COPY_EXISTING ~clsrcreq.2da~ ~override~
  COUNT_2DA_ROWS 8 rows
  FOR (row = 0 ; row < rows ; ++row) BEGIN
    READ_2DA_ENTRY row 0 8 entry
    PATCH_IF (("%entry%" STRING_COMPARE_CASE "FIGHTER_CLERIC"      = 0) OR
              ("%entry%" STRING_COMPARE_CASE "CLERIC_THIEF"        = 0)) BEGIN // cleric/thief, fighter/cleric
      SET_2DA_ENTRY  row 1 8 1
      SET_2DA_ENTRY  row 2 8 1
      SET_2DA_ENTRY  row 3 8 1
      SET_2DA_ENTRY  row 4 8 1
      SET_2DA_ENTRY  row 5 8 1
      SET_2DA_ENTRY  row 6 8 1
      SET_2DA_ENTRY  row 7 8 1
    END
    PATCH_IF (("%entry%" STRING_COMPARE_CASE "CLERIC_MAGE"         = 0) OR
              ("%entry%" STRING_COMPARE_CASE "FIGHTER_MAGE_CLERIC" = 0)) BEGIN // cleric/mage
      SET_2DA_ENTRY  row 1 8 1
      SET_2DA_ENTRY  row 2 8 1
      SET_2DA_ENTRY  row 3 8 1
      SET_2DA_ENTRY  row 6 8 1
    END
    PATCH_IF (("%entry%" STRING_COMPARE_CASE "CLERIC_RANGER"       = 0)) BEGIN // cleric/ranger
      SET_2DA_ENTRY  row 1 8 1
      SET_2DA_ENTRY  row 2 8 1
      SET_2DA_ENTRY  row 3 8 1
    END
    PATCH_IF (("%entry%" STRING_COMPARE_CASE "FIGHTER_MAGE"        = 0) OR
              ("%entry%" STRING_COMPARE_CASE "FIGHTER_THIEF"       = 0) OR
              ("%entry%" STRING_COMPARE_CASE "FIGHTER_MAGE_THIEF"  = 0) OR
              ("%entry%" STRING_COMPARE_CASE "MAGE_THIEF"          = 0)) BEGIN // other human multiclasses
      SET_2DA_ENTRY  row 1 8 1
    END
    PATCH_IF (("%entry%" STRING_COMPARE_CASE "FIGHTER_DRUID"       = 0)) BEGIN // no druid multiclasses
      SET_2DA_ENTRY  row 1 8 0
      SET_2DA_ENTRY  row 2 8 0
      SET_2DA_ENTRY  row 3 8 0
      SET_2DA_ENTRY  row 4 8 0
      SET_2DA_ENTRY  row 5 8 0
      SET_2DA_ENTRY  row 6 8 0
      SET_2DA_ENTRY  row 7 8 0
    END
  END
  PRETTY_PRINT_2DA
 BUT_ONLY
END
//___________________________________________________________________________________

//___________________________________________________________________________________
//
LAM cleric_tymora
//___________________________________________________________________________________

// clerics:

//___________________________________________________________________________________
BEGIN @201  //  cleric of lathander
DESIGNATED 201
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8

LAM cleric_lathander
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @202  //  cleric of torm
DESIGNATED 202
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8

LAM cleric_torm
//___________________________________________________________________________________

/*
//___________________________________________________________________________________
BEGIN @205  //  cleric of tymora
DESIGNATED 205
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8

LAM cleric_tymora
//___________________________________________________________________________________
*/

//___________________________________________________________________________________
BEGIN @208  //  cleric of helm
DESIGNATED 208
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8

LAM cleric_helm
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @209  //  cleric of kelemvor
DESIGNATED 209
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8
REQUIRE_PREDICATE NOT GAME_IS ~iwdee~ @8

LAM cleric_kelemvor
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @210  //  cleric of tempus
DESIGNATED 210
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8

LAM cleric_tempus
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @212  //  cleric of leira
DESIGNATED 212
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8

LAM cleric_leira
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @219  //  cleric of loviatar
DESIGNATED 219
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8

LAM cleric_loviatar
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @224  //  cleric of talos
DESIGNATED 224
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8

LAM cleric_talos
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @213  //  cleric of baravar
DESIGNATED 213
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8

LAM cleric_baravar
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @225  //  cleric of cyric
DESIGNATED 225
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8
REQUIRE_PREDICATE NOT GAME_IS ~iwdee~ @8

LAM cleric_cyric
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @226  //  cleric of umberlee
DESIGNATED 226
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8

LAM cleric_umberlee
//___________________________________________________________________________________

// acolytes:

//___________________________________________________________________________________
BEGIN @314  //  acolyte of ilmater
DESIGNATED 314
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8

LAM acolyte_ilmater
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @315  //  acolyte of deneir
DESIGNATED 315
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8

LAM acolyte_deneir
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @316  //  acolyte of sune
DESIGNATED 316
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8

LAM acolyte_sune
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @322  //  acolyte of tempus
DESIGNATED 322
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8

LAM acolyte_tempus
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @325  //  acolyte of mystra
DESIGNATED 325
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8

LAM acolyte_mystra
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @329  //  acolyte of mask
DESIGNATED 329
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8

LAM acolyte_mask
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @330  //  acolyte of shar
DESIGNATED 330
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8

LAM acolyte_shar
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @331  //  acolyte of moander
DESIGNATED 331
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8

LAM acolyte_moander
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @332  //  acolyte of beshaba
DESIGNATED 332
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8

LAM acolyte_beshaba
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @342  //  acolyte of baervan
DESIGNATED 342
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~200~ @8

LAM acolyte_baervan
//___________________________________________________________________________________



//__________________________________________________________________________________
//__________________________________________________________________________________
//
//					CHOOSE INDIVIDUAL DRUID KITS
//__________________________________________________________________________________
//__________________________________________________________________________________

BEGIN @700 // install new druid kits along with the vanilla ones
DESIGNATED 700
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~103~ @8

//copy marker file___________________________________________________________________
//
COPY ~faiths_and_powers/lib/markers/d5_druids.d5~ ~override~
//___________________________________________________________________________________

//replace base kits, forest druid = default__________________________________________
//
LAM forest_druid
//___________________________________________________________________________________

//replace base druid clab for fighter/druids_________________________________________
//
//COPY ~faiths_and_powers/kits/druids/731_forest_druid/d5dfor.2da~ ~override/clabdr01.2da~
//___________________________________________________________________________________

//change druid class text____________________________________________________________
//
ACTION_IF (FILE_EXISTS_IN_GAME ~clastext.2da~) BEGIN
  COPY_EXISTING ~clastext.2da~ ~override~
	COUNT_2DA_COLS cols // amount of columns
	READ_2DA_ENTRIES_NOW rows cols // read all file into memory  
	FOR (row = 1; row < rows; ++row) BEGIN // iterate over rows
	  READ_2DA_ENTRY_FORMER rows row 0 ~text~ // read column value
	  PATCH_IF ~%text%~ STRING_EQUAL_CASE ~DRUID~ BEGIN
	    SET patch_row = %row%
	  END
	END
	SET_2DA_ENTRY %patch_row% 3 cols RESOLVE_STR_REF (@70001)
	SET_2DA_ENTRY %patch_row% 5 cols RESOLVE_STR_REF (@70002)
	SET_2DA_ENTRY %patch_row% 4 cols RESOLVE_STR_REF (@70003)
  BUT_ONLY
END
ACTION_IF (FILE_EXISTS_IN_GAME ~sodcltxt.2da~) BEGIN
  COPY_EXISTING ~sodcltxt.2da~ ~override~
	COUNT_2DA_COLS cols // amount of columns
	READ_2DA_ENTRIES_NOW rows cols // read all file into memory  
	FOR (row = 1; row < rows; ++row) BEGIN // iterate over rows
	  READ_2DA_ENTRY_FORMER rows row 0 ~text~ // read column value
	  PATCH_IF ~%text%~ STRING_EQUAL_CASE ~DRUID~ BEGIN
	    SET patch_row = %row%
	  END
	END
	SET_2DA_ENTRY %patch_row% 3 cols RESOLVE_STR_REF (@70001)
	SET_2DA_ENTRY %patch_row% 5 cols RESOLVE_STR_REF (@70002)
	SET_2DA_ENTRY %patch_row% 4 cols RESOLVE_STR_REF (@70003)
  BUT_ONLY
END
//__________________________________________________________________________________

/*
//add new mc druid kits_____________________________________________________________
//
ACTION_IF FILE_EXISTS_IN_GAME ~d5_clerics.d5~ BEGIN
	INCLUDE ~faiths_and_powers/kits/multiclass/452_fighter_druid/fighter_druid.tpa~
	INCLUDE ~faiths_and_powers/kits/multiclass/453_druid_mage/druid_mage.tpa~
	INCLUDE ~faiths_and_powers/kits/multiclass/454_druid_thief/druid_thief.tpa~
	INCLUDE ~faiths_and_powers/kits/multiclass/455_druid_ranger/druid_ranger.tpa~
END
//__________________________________________________________________________________
*/

// druid kits:

//___________________________________________________________________________________
BEGIN @732  //  mountain druid
DESIGNATED 732
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~700~ @8

LAM mountain_druid
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @733  //  jungle druid
DESIGNATED 733
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~700~ @8

LAM jungle_druid
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @734  //  desert druid
DESIGNATED 734
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~700~ @8

LAM desert_druid
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @735  //  arctic druid
DESIGNATED 735
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~700~ @8

LAM arctic_druid
//___________________________________________________________________________________

// mystics:

//___________________________________________________________________________________
BEGIN @703  //  earth mystic
DESIGNATED 703
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~700~ @8

LAM earth_mystic
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @704  //  water mystic
DESIGNATED 704
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~700~ @8

LAM water_mystic
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @705  //  air mystic
DESIGNATED 705
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~700~ @8

LAM air_mystic
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @706  //  fire mystic
DESIGNATED 706
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~700~ @8

LAM fire_mystic
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @707  //  light mystic
DESIGNATED 707
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~700~ @8

LAM light_mystic
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @708  //  shadow mystic
DESIGNATED 708
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~700~ @8

LAM shadow_mystic
//___________________________________________________________________________________

// occultists:

//___________________________________________________________________________________
BEGIN @762  //  beast lord
DESIGNATED 762
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~700~ @8

LAM beast_lord
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @763  //  elementalist
DESIGNATED 763
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~700~ @8

LAM elementalist
//___________________________________________________________________________________



//__________________________________________________________________________________
//__________________________________________________________________________________
//
//					CHOOSE INDIVIDUAL PALADIN KITS
//__________________________________________________________________________________
//__________________________________________________________________________________

BEGIN @800 // install new paladin kits
DESIGNATED 800
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~103~ @8

//copy marker file___________________________________________________________________
//
COPY ~faiths_and_powers/lib/markers/d5_paladins.d5~ ~override~
//___________________________________________________________________________________

// (paladins)
//any race can have their pallys
COPY_EXISTING ~clsrcreq.2da~ ~override~ //Testing...
//pally
    SET_2DA_ENTRY 29 2 8 1
    SET_2DA_ENTRY 29 3 8 1
    SET_2DA_ENTRY 29 4 8 1
    SET_2DA_ENTRY 29 5 8 1
    SET_2DA_ENTRY 29 6 8 1
    SET_2DA_ENTRY 29 7 8 1
//b guard
    SET_2DA_ENTRY 33 2 8 1
    SET_2DA_ENTRY 33 3 8 1
    SET_2DA_ENTRY 33 4 8 1
    SET_2DA_ENTRY 33 5 8 1
    SET_2DA_ENTRY 33 6 8 1
    SET_2DA_ENTRY 33 7 8 1
BUT_ONLY_IF_IT_CHANGES
//Dwarves need to be able to take the champion class.  Cha 13 requirement
COPY_EXISTING ~ABCLASRQ.2da~ ~override~ //
//Pally
    SET_2DA_ENTRY 6 6 6 13
    SET_2DA_ENTRY 30 6 6 13
    SET_2DA_ENTRY 31 6 6 13
    SET_2DA_ENTRY 32 6 6 13
BUT_ONLY_IF_IT_CHANGES

LAM champion_tyr

//sneaky sneaky
COPY ~faiths_and_powers/kits/zealots/b_sneak.spl~ ~override~
COPY ~faiths_and_powers/kits/zealots/b_snk02.spl~ ~override~
COPY ~faiths_and_powers/kits/zealots/b_snk03.spl~ ~override~
COPY ~faiths_and_powers/kits/zealots/b_snk04.spl~ ~override~
COPY ~faiths_and_powers/kits/zealots/b_snk05.spl~ ~override~
COPY ~faiths_and_powers/kits/zealots/b_snk06.spl~ ~override~
COPY ~faiths_and_powers/kits/zealots/b_snk07.spl~ ~override~
COPY ~faiths_and_powers/kits/zealots/b_snk08.spl~ ~override~
COPY ~faiths_and_powers/kits/zealots/b_snk09.spl~ ~override~
COPY ~faiths_and_powers/kits/zealots/b_snk10.spl~ ~override~
COPY ~faiths_and_powers/kits/zealots/b_snk11.spl~ ~override~
COPY ~faiths_and_powers/kits/zealots/b_snk12.spl~ ~override~
COPY ~faiths_and_powers/kits/zealots/b_snk13.spl~ ~override~
//___________________________________________________________________________________


//___________________________________________________________________________________
BEGIN @802  //  champion of kelemvor
DESIGNATED 802
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~800~ @8

//champ of Kele effectively replaces UHunter. In IWDEE, the champ of mykrul is merely added (they're different enough conceptually to be seperate)
ACTION_IF GAME_IS ~iwdee~ THEN BEGIN   //
  LAM iwdee_champion_kelemvor
  COPY_EXISTING ~clsrcreq.2da~ ~override~ //
END
//kelevmore undead hunter for non-iwdee
ACTION_IF GAME_IS ~bgee bg2ee eet~ THEN BEGIN   //
  LAM champion_kelemvor
END
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @803  //  champion of azuth
DESIGNATED 803
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~800~ @8

//azuth essentially replaces Inquisitor
LAM champion_azuth
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @804  //  champion of tempus
DESIGNATED 804
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~800~ @8
REQUIRE_PREDICATE FILE_EXISTS_IN_GAME ~fallen.2da~ @8  //No feasible way to make them not fall in IWDEE as yet

LAM champion_tempus
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @805  //  champion of bane
DESIGNATED 805
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~800~ @8

ACTION_IF FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No Evil nonfallable pallys in IWDEE as yet
  LAM champion_bane
END
ACTION_IF NOT FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No Evil nonfallable pallys in IWDEE as yet
  LAM iwdee_champion_bane
END
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @806  //  champion of helm
DESIGNATED 806
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~800~ @8

ACTION_IF FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No Evil nonfallable pallys in IWDEE as yet
  LAM champion_helm
END
ACTION_IF NOT FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No Evil fallable pallys in IWDEE
  LAM iwdee_champion_helm
END
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @807  //  champion of talos
DESIGNATED 807
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~800~ @8

ACTION_IF FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No Evil nonfallable pallys in IWDEE
  LAM champion_talos
END
ACTION_IF NOT FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No Evil nonfallable pallys in IWDEE
  LAM iwdee_champion_talos
END
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @808  //  champion of moradin
DESIGNATED 808
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~800~ @8

LAM champion_moradin
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @809  //  champion of red knight
DESIGNATED 809
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~800~ @8
REQUIRE_PREDICATE FILE_EXISTS_IN_GAME ~fallen.2da~ @8  //No feasible way to make them not fall in IWDEE as yet

LAM champion_red
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @862  //  zealot of gruumsh
DESIGNATED 862
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~800~ @8
REQUIRE_PREDICATE FILE_EXISTS_IN_GAME ~fallen.2da~ @8  //No feasible way to make them not fall in IWDEE as yet

LAM zealot_gruumsh
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @863  //  zealot of talos
DESIGNATED 863
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~800~ @8
REQUIRE_PREDICATE FILE_EXISTS_IN_GAME ~fallen.2da~ @8  //No feasible way to make them not fall in IWDEE as yet

LAM zealot_talos
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @864  //  zealot of kossuth
DESIGNATED 864
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~800~ @8
REQUIRE_PREDICATE FILE_EXISTS_IN_GAME ~fallen.2da~ @8  //No feasible way to make them not fall in IWDEE as yet

LAM zealot_kossuth
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @865  //  zealot of garagos
DESIGNATED 865
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~800~ @8
REQUIRE_PREDICATE FILE_EXISTS_IN_GAME ~fallen.2da~ @8  //No feasible way to make them not fall in IWDEE as yet

LAM zealot_garagos
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @866  //  zealot of ilmater
DESIGNATED 866
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~800~ @8
REQUIRE_PREDICATE FILE_EXISTS_IN_GAME ~fallen.2da~ @8  //No feasible way to make them not fall in IWDEE as yet

LAM zealot_ilmater
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @867  //  zealot of corellon
DESIGNATED 867
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~800~ @8
REQUIRE_PREDICATE FILE_EXISTS_IN_GAME ~fallen.2da~ @8  //No feasible way to make them not fall in IWDEE as yet

LAM zealot_corellon
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @868  //  zealot of sune
DESIGNATED 868
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~800~ @8
REQUIRE_PREDICATE FILE_EXISTS_IN_GAME ~fallen.2da~ @8  //No feasible way to make them not fall in IWDEE as yet

LAM zealot_sune
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @869  //  zealot of mystra
DESIGNATED 869
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~800~ @8
REQUIRE_PREDICATE FILE_EXISTS_IN_GAME ~fallen.2da~ @8  //No feasible way to make them not fall in IWDEE as yet

LAM zealot_mystra
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @870  //  zealot of eilistraee
DESIGNATED 870
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~800~ @8
REQUIRE_PREDICATE FILE_EXISTS_IN_GAME ~fallen.2da~ @8  //No feasible way to make them not fall in IWDEE as yet

LAM zealot_eilistraee
//___________________________________________________________________________________



//__________________________________________________________________________________
//__________________________________________________________________________________
//
//					CHOOSE INDIVIDUAL RANGER KITS
//__________________________________________________________________________________
//__________________________________________________________________________________

BEGIN @900 // install new and revised ranger kits
DESIGNATED 900
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~103~ @8

//copy marker file___________________________________________________________________
//
COPY ~faiths_and_powers/lib/markers/d5_rangers.d5~ ~override~
//___________________________________________________________________________________

//replace base kits, forest ranger = default_________________________________________
//
LAM forest_ranger
//___________________________________________________________________________________

// ranger kits:

/*
//forest ranger = default____________________________________________________________
//
BEGIN @901  //  forest ranger
DESIGNATED 901
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~900~ @8

LAM forest_ranger
//___________________________________________________________________________________
*/

//___________________________________________________________________________________
BEGIN @902  //  mountain ranger
DESIGNATED 902
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~900~ @8

LAM mountain_ranger
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @903  //  jungle ranger
DESIGNATED 903
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~900~ @8

LAM jungle_ranger
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @904  //  desert ranger
DESIGNATED 904
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~900~ @8

LAM desert_ranger
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @905  //  arctic ranger
DESIGNATED 905
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~900~ @8

LAM arctic_ranger
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @932  //  beast master
DESIGNATED 932
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~900~ @8

LAM beast_master
//___________________________________________________________________________________

// scout kits:

//___________________________________________________________________________________
BEGIN @954  //  barbarian ranger
DESIGNATED 954
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~900~ @8

LAM barbarian_ranger
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @953  //  mage hunter
DESIGNATED 953
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~900~ @8

LAM mage_hunter
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @955  //  elven archer
DESIGNATED 955
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~900~ @8

LAM elven_archer
//___________________________________________________________________________________

//___________________________________________________________________________________
BEGIN @956  //  halfling slinger
DESIGNATED 956
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~900~ @8

LAM halfling_slinger

COPY_EXISTING ~kitlist.2da~ ~override~
	COUNT_2DA_COLS cols // amount of columns
	READ_2DA_ENTRIES_NOW rows cols // read all file into memory  
	FOR (row = 1; row < rows; ++row) BEGIN // iterate over rows
	  READ_2DA_ENTRY_FORMER rows row 1 ~sling~ // read column value
	  PATCH_IF ~%sling%~ STRING_EQUAL_CASE ~D5SLING~ BEGIN
	    SET sling_row = (%row% + 1)
	  END
	END
  BUT_ONLY
COPY ~faiths_and_powers/kits/K_X_Y/K_R_HL.2da~ ~override~
	REPLACE_TEXTUALLY ~[ %TAB%]0~ ~%TAB%%sling_row%~
//___________________________________________________________________________________



/*
// FnP item usability

//___________________________________________________________________________________
BEGIN @110  //  item usability
DESIGNATED 110
INSTALL_BY_DEFAULT
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~103~ @8

LAM d5_item_usability

ACTION_IF (%d5_item_use% = 1) BEGIN
  INCLUDE ~faiths_and_powers/lib/item_usability.tpa~
END
//__________________________________________________________________________________
*/



//__________________________________________________________________________________
//__________________________________________________________________________________
//
//							SPHERE SYSTEM
//__________________________________________________________________________________
//__________________________________________________________________________________

BEGIN @1000
DESIGNATED 1000
REQUIRE_COMPONENT ~faiths_and_powers.tp2~ ~103~ @8
REQUIRE_PREDICATE (GAME_IS ~bgee bg2ee eet iwdee~) ~Enhanced Edition game required!~


//vanilla kits___________________________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/vanilla_kit_spheres.tpa~
//___________________________________________________________________________________

//mod kits___________________________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/mod_kit_spheres.tpa~
//___________________________________________________________________________________

//default access_______________________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/default_kit_spheres.tpa~
//___________________________________________________________________________________

//Add IWD spells if not already in game
ACTION_IF GAME_IS ~bgee bg2ee eet~ BEGIN
 ACTION_IF NOT MOD_IS_INSTALLED ~setup-iwdification.tp2~ ~40~ BEGIN  //If IWDification not installed...
  ACTION_IF NOT FILE_EXISTS_IN_GAME ~b_IWD.itm~ BEGIN    			//If b_ IWD spells not installed...
	COPY ~faiths_and_powers/compatibility/b_IWD.itm~ ~override~   	//to detect this component 
	INCLUDE ~faiths_and_powers/lib/Setup_IWD_divine_Spells.tpa~    	//install them
  END
 END
END

//read fnp_compat info______________________________________________________________
//
LAM ~READ_FNP_KIT_INFO~
//__________________________________________________________________________________

//deity selection___________________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/deity_selection.tpa~
//__________________________________________________________________________________

//alter item usability______________________________________________________________
//
LAM d5_item_usability

ACTION_IF (%d5_item_use% = 1) BEGIN
  INCLUDE ~faiths_and_powers/lib/item_usability.tpa~
END
//__________________________________________________________________________________

//Sphere System_____________________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/sphere_system.tpa~
//___________________________________________________________________________________

//Handle NPCs_______________________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/npc_kits.tpa~
//__________________________________________________________________________________

