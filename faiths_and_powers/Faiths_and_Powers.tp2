BACKUP ~faiths_and_powers/backup~
AUTHOR ~SubtleD and Grammarsalad~


VERSION ~0.84.00~


//README ~faiths_and_powers/readme-pnp.html~


ASK_EVERY_COMPONENT


ALWAYS

	ACTION_IF GAME_IS ~iwdee~ BEGIN
	  ACTION_IF FILE_EXISTS_IN_GAME "#bonecir.spl" BEGIN
		DISABLE_FROM_KEY "#bonecir.spl"
	  END
	  ACTION_IF FILE_EXISTS "override\#bonecir.spl" BEGIN
		DELETE "override\#bonecir.spl"
	  END
	END

  	OUTER_SPRINT ~mod_folder~ ~faiths_and_powers~
        OUTER_SPRINT ~folder~ ~faiths_and_powers~

	ACTION_IF !(FILE_EXISTS ~override/d5_fnp_settings.ini~) BEGIN
  	  COPY ~faiths_and_powers/d5_fnp_settings.ini~ ~override~
	END
 
  	INCLUDE ~override/d5_fnp_settings.ini~
  	
	INCLUDE ~faiths_and_powers/lib/effect_return.tpa~

	INCLUDE ~faiths_and_powers/lib/item_in_store.tpa~

	INCLUDE ~faiths_and_powers/lib/nu_alter_effect.tpa~

	INCLUDE ~faiths_and_powers/lib/qd_multiclass.tpa~

	INCLUDE ~faiths_and_powers/lib/system_misc_functions.tpa~

	INCLUDE ~faiths_and_powers/lib/system_base.tpa~

	INCLUDE ~faiths_and_powers/lib/system_spheres.tpa~
	
	INCLUDE ~faiths_and_powers/lib/system_fnp_spontaneous.tpa~

	INCLUDE ~faiths_and_powers/lib/spell_evasion.tpa~
	
	INCLUDE ~faiths_and_powers/lib/bg2fp_effect_batches_fnp.tpa~

	INCLUDE ~faiths_and_powers/lib/fl#add_kit_ee.tpa~

//	INCLUDE ~faiths_and_powers/lib/spell_clone_effects.tpa~

	DEFINE_ACTION_MACRO d5_minor_access_levels BEGIN
	  OUTER_SET d5_minor_shift = 0
	END
	
	LAF fix_kitlist_missing_ids END

	ACTION_IF FILE_EXISTS_IN_GAME ~a#ooze.2da~ BEGIN
	  COPY_EXISTING ~alignmnt.2da~ ~override~
		REPLACE_TEXTUALLY ~DRUID.+$~ ~DRUID	0	1	0	1	1	1	0	1	0 ~
		REPLACE_TEXTUALLY ~FIGHTER_DRUID.+$~ ~FIGHTER_DRUID	0	1	0	1	1	1	0	1	0 ~
		REPLACE_TEXTUALLY ~TOTEMIC_DRUID.+$~ ~TOTEMIC_DRUID	0	1	0	1	1	1	0	1	0 ~
		REPLACE_TEXTUALLY ~SHAPESHIFTER.+$~ ~SHAPESHIFTER	0	1	0	1	1	1	0	1	0 ~
		REPLACE_TEXTUALLY ~BEAST_FRIEND.+$~ ~BEAST_FRIEND	0	1	0	1	1	1	0	1	0 ~
	END

	COPY ~faiths_and_powers/kits/clerics/B_LOR.spl~ ~override~

// joinable NPC issues for tutu/bgt/eet:
  ACTION_IF GAME_IS ~bgee~ BEGIN
    OUTER_SPRINT tutu_var ~~
    OUTER_SPRINT imoen6_var ~imoen6~
    OUTER_SPRINT jaheir7_var ~jaheir7~
    OUTER_SPRINT minsc7_var ~minsc7~
    OUTER_SPRINT quayle_var ~quayle~
    OUTER_SPRINT viconi6_var ~viconi6~
    OUTER_SPRINT xan_var ~xan~
    OUTER_SPRINT xzar_var ~xzar~
  END ELSE ACTION_IF GAME_IS ~eet~ BEGIN
    OUTER_SPRINT tutu_var ~~
    OUTER_SPRINT imoen6_var ~imoen6_~
    OUTER_SPRINT jaheir7_var ~jaheir7_~
    OUTER_SPRINT minsc7_var ~minsc7_~
    OUTER_SPRINT quayle_var ~quayle_~
    OUTER_SPRINT viconi6_var ~viconi6_~
    OUTER_SPRINT xan_var ~xan_~
    OUTER_SPRINT xzar_var ~xzar_~
  END ELSE ACTION_IF GAME_IS ~bgt~ BEGIN
    OUTER_SPRINT tutu_var ~~
    OUTER_SPRINT imoen6_var ~imoen61~
    OUTER_SPRINT quayle_var ~bgquayle~
    OUTER_SPRINT viconi6_var ~viconi61~
    OUTER_SPRINT xan_var ~bgxan~
    OUTER_SPRINT xzar_var ~bgxzar~
  END ELSE ACTION_IF GAME_IS ~tutu tutu_totsc~ BEGIN
    OUTER_SPRINT tutu_var ~_~
    OUTER_SPRINT imoen6_var ~imoen6~
    OUTER_SPRINT quayle_var ~quayle~
    OUTER_SPRINT viconi6_var ~viconi6~
    OUTER_SPRINT xan_var ~xan~
    OUTER_SPRINT xzar_var ~xzar~
  END

END

// ASK_EVERY_COMPONENT

LANGUAGE
  ~English~
  ~english~
  ~faiths_and_powers/language/english/setup.tra~
  ~faiths_and_powers/language/english/IWD_spells.tra~
  ~faiths_and_powers/language/english/new_spells.tra~
  ~faiths_and_powers/language/english/HLA.tra~
//___________________________________________________________________________________


////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////


//__________________________________________________________________________________
//__________________________________________________________________________________
//
//								CHOOSE SPHERE SYSTEM
//__________________________________________________________________________________
//__________________________________________________________________________________

BEGIN @21 // FnP original sphere system
DESIGNATED 21
SUBCOMPONENT @20 
REQUIRE_PREDICATE (GAME_IS ~bgee bg2ee eet iwdee~) @8

COPY ~faiths_and_powers/lib/markers/d5_marker.d5~ ~override/d5__spheres.d5~
COPY ~faiths_and_powers/lib/markers/d5_marker.d5~ ~override/d5__fnp_spheres.d5~

ACTION_IF (FILE_EXISTS_IN_GAME ~fnp_sphere_list.tpa~) BEGIN
  MOVE ~override/fnp_sphere_list.tpa~ ~weidu_external/faiths_and_powers/fnp_sphere_list_old.tpa~
END

//prep sphere system________________________________________________________________
//
COPY ~faiths_and_powers/data/sphere_systems/sphere_list_fnp.tpa~ ~override/fnp_sphere_list.tpa~

//change shaman known spells________________________________________________________
//
//LAF shaman_spells END
//... nope, fold this into the d5_spontaneous function

//Add IWD and new spells____________________________________________________________
//
LAM d5_spell_options

ACTION_CLEAR_ARRAY aoe_spell

ACTION_IF (include_new_FNP_spells = 1) BEGIN
  INCLUDE ~faiths_and_powers/lib/spells_new_v75.tpa~      	//includes spells from the 0.75 series  
  INCLUDE ~faiths_and_powers/lib/spells_new_fnp.tpa~   		//new spells from the 0.77 series 
//  LAM v75_add_fnP_new_spells
  LAM v78_add_FnP_new_spells
END

ACTION_IF !(GAME_IS ~iwdee~) BEGIN
  ACTION_IF (include_IWD_arcane_spells = 1) BEGIN
    LAM v75_add_iwd_arcane_spells
  END
  ACTION_IF (include_IWD_divine_spells = 1) BEGIN
    LAM v75_add_iwd_divine_spells
  END
END

ACTION_IF (FILE_EXISTS_IN_GAME ~dvsrv4here.mrk~) BEGIN
  LAM v75_apply_sr_aoe_deflection
END  

LAF fix_spell_bams END
// ***** ^^ make this fix summoning spells if IWD+SR installed?

COPY ~faiths_and_powers/data/hlas/system_FnP/~ ~weidu_external/faiths_and_powers/hlas~

//INCLUDE ~%mod_folder%/lib/immunities.tpa~					//	DO AT THE VERY END OF ALL SPELL INSTALLS

INCLUDE ~faiths_and_powers/lib/system_spheres.tpa~

 LAF prep_vanilla_spells END

INCLUDE ~override/fnp_sphere_list.tpa~
 LAM define_sphere_names
 LAM d5_define_sphere_spells
 LAM d5_deity_kit_sphere_lists

LAF create_spheres END

//__________________________________________________________________________________



//__________________________________________________________________________________
//__________________________________________________________________________________

BEGIN @22 // 2E-style sphere system
DESIGNATED 22
SUBCOMPONENT @20

COPY ~faiths_and_powers/lib/markers/d5_marker.d5~ ~override/d5__spheres.d5~
COPY ~faiths_and_powers/lib/markers/d5_marker.d5~ ~override/d5__2e_spheres.d5~

ACTION_IF (FILE_EXISTS_IN_GAME ~fnp_sphere_list.tpa~) BEGIN
  MOVE ~override/fnp_sphere_list.tpa~ ~override/fnp_sphere_list_old.tpa~
END

//prep sphere system________________________________________________________________
//
COPY ~faiths_and_powers/data/sphere_systems/sphere_list_2E.tpa~ ~override/fnp_sphere_list.tpa~

//change shaman known spells________________________________________________________
//
//LAF shaman_spells END

//Add IWD and new spells____________________________________________________________
//
LAM d5_spell_options

ACTION_CLEAR_ARRAY aoe_spell

ACTION_IF (include_new_FNP_spells = 1) BEGIN
  INCLUDE ~faiths_and_powers/lib/spells_new_v75.tpa~      	//includes spells from the 0.75 series  
  INCLUDE ~faiths_and_powers/lib/spells_new_fnp.tpa~   		//new spells from the 0.77 series 
//  LAM v75_add_fnP_new_spells
  v78_add_FnP_new_spells
END

ACTION_IF !(GAME_IS ~iwdee~) BEGIN
  ACTION_IF (include_IWD_arcane_spells = 1) BEGIN
    LAM v75_add_iwd_arcane_spells
  END
  ACTION_IF (include_IWD_divine_spells = 1) BEGIN
    LAM v75_add_iwd_divine_spells
  END
END

ACTION_IF (FILE_EXISTS_IN_GAME ~dvsrv4here.mrk~) BEGIN
  LAM v75_apply_sr_aoe_deflection
END  

LAF fix_spell_bams END

COPY ~faiths_and_powers/data/hlas/system_2E/~ ~weidu_external/faiths_and_powers/hlas~

//INCLUDE ~%mod_folder%/lib/immunities.tpa~					//	DO AT THE VERY END OF ALL SPELL INSTALLS

//create sphere system______________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/system_spheres.tpa~

 LAF prep_vanilla_spells END

INCLUDE ~override/fnp_sphere_list.tpa~
 LAM define_sphere_names
 LAM d5_define_sphere_spells
 LAM d5_deity_kit_sphere_lists

LAF create_spheres END
//__________________________________________________________________________________



//__________________________________________________________________________________
//__________________________________________________________________________________

BEGIN @23 // mostly vanilla - same as unmodded game, but kits can cross the cleric/druid divide
DESIGNATED 23
SUBCOMPONENT @20 
REQUIRE_PREDICATE (GAME_IS ~bgee bg2ee eet iwdee~) @8

COPY ~faiths_and_powers/lib/markers/d5_marker.d5~ ~override/d5__spheres.d5~
COPY ~faiths_and_powers/lib/markers/d5_marker.d5~ ~override/d5__vanilla_spheres.d5~

ACTION_IF (FILE_EXISTS_IN_GAME ~fnp_sphere_list.tpa~) BEGIN
  MOVE ~override/fnp_sphere_list.tpa~ ~weidu_external/faiths_and_powers/fnp_sphere_list_old.tpa~
END

//prep sphere system________________________________________________________________
//
COPY ~faiths_and_powers/data/sphere_systems/sphere_list_vanilla.tpa~ ~override/fnp_sphere_list.tpa~

//change shaman known spells________________________________________________________
//
//LAF shaman_spells END
//... nope, fold this into the d5_spontaneous function

//Add IWD and new spells____________________________________________________________
//
LAM d5_spell_options

ACTION_CLEAR_ARRAY aoe_spell

ACTION_IF (include_new_FNP_spells = 1) BEGIN
  INCLUDE ~faiths_and_powers/lib/spells_new_v75.tpa~      	//includes spells from the 0.75 series  
  INCLUDE ~faiths_and_powers/lib/spells_new_fnp.tpa~   		//new spells from the 0.77 series 
//  LAM v75_add_fnP_new_spells
  LAM v78_add_FnP_new_spells
END

/*
ACTION_IF !(GAME_IS ~iwdee~) BEGIN
  ACTION_IF (include_IWD_arcane_spells = 1) BEGIN
    LAM v75_add_iwd_arcane_spells
  END
  ACTION_IF (include_IWD_divine_spells = 1) BEGIN
    LAM v75_add_iwd_divine_spells
  END
END
*/

ACTION_IF (FILE_EXISTS_IN_GAME ~dvsrv4here.mrk~) BEGIN
  LAM v75_apply_sr_aoe_deflection
END  

LAF fix_spell_bams END

COPY ~faiths_and_powers/data/hlas/system_vplus/~ ~weidu_external/faiths_and_powers/hlas~

//INCLUDE ~%mod_folder%/lib/immunities.tpa~					//	DO AT THE VERY END OF ALL SPELL INSTALLS

//create sphere system______________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/system_spheres.tpa~

INCLUDE ~override/fnp_sphere_list.tpa~
 LAM define_sphere_names
 LAM d5_define_sphere_spells
 LAM d5_deity_kit_sphere_lists

COPY ~d5/d5spsph.2da~ ~override~

COPY_EXISTING_REGEXP ~^[Ss][Pp][Pp][Rr][1-7]\([0-4][0-9]\|50\)\.spl$~ ~override~
  PATCH_IF (%SOURCE_SIZE% > 0x71) BEGIN
    PATCH_IF !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR721~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR722~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR723~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR724~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR725~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR726~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR727~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR728~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR729~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR730~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR731~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR732~) BEGIN
	  PATCH_IF !(FILE_CONTAINS_EVALUATED (~hidespl.2da~ ~%SOURCE_RES%~)) BEGIN
	    READ_SHORT 0x1c ~spelltype~
	    PATCH_IF (~spelltype~ = 2) BEGIN
	      READ_BYTE 0x21 exclude
	      PATCH_IF ((exclude BAND 0b11000000) = 0b10000000) BEGIN // valid for clerics
	        SPRINT $cleric_only_spells(~%SOURCE_RES%~)~1~
	      END
	      PATCH_IF ((exclude BAND 0b11000000) = 0b01000000) BEGIN // valid for druids
	        SPRINT $druid_only_spells(~%SOURCE_RES%~)~1~
	      END
	      PATCH_IF ((exclude BAND 0b11000000) = 0b00000000) BEGIN // valid for both
	        SPRINT $cleric_druid_spells(~%SOURCE_RES%~)~1~
	      END
	      PATCH_IF ((exclude BAND 0b11000000) = 0b11000000) BEGIN // valid for neither
	        SPRINT $shaman_only_spells(~%SOURCE_RES%~)~1~
	      END
	    END
	  END
	END
  END
BUT_ONLY

ACTION_PHP_EACH cleric_only_spells AS res => ind BEGIN
  APPEND ~d5spsph.2da~ ~%res%                 0	=	Cleric~
END
ACTION_PHP_EACH druid_only_spells AS res => ind BEGIN
  APPEND ~d5spsph.2da~ ~%res%                 0	=	Druid~
END
ACTION_PHP_EACH cleric_druid_spells AS res => ind BEGIN
  APPEND ~d5spsph.2da~ ~%res%                 0	=	Cleric~
  APPEND ~d5spsph.2da~ ~%res%                 0	=	Druid~
END

LAF prep_vanilla_spells END

LAF create_spheres END

//all HLAs for everyone_____________________________________________________________
//
COPY_EXISTING ~faiths_and_powers/data/hlas/system_vplus/luclxyz.2da~ ~override~
COPY_EXISTING ~faiths_and_powers/data/hlas/system_vplus/ludrxyz.2da~ ~override~
COPY_EXISTING ~faiths_and_powers/data/hlas/system_vplus/lufcxyz.2da~ ~override~
COPY_EXISTING ~faiths_and_powers/data/hlas/system_vplus/lucrxyz.2da~ ~override~
COPY_EXISTING ~faiths_and_powers/data/hlas/system_vplus/luctxyz.2da~ ~override~
COPY_EXISTING ~faiths_and_powers/data/hlas/system_vplus/lucmxyz.2da~ ~override~
//__________________________________________________________________________________



//__________________________________________________________________________________
//__________________________________________________________________________________

BEGIN @24 // vanilla plus - same as unmodded game, but kits gets focus access to two spheres
DESIGNATED 24
SUBCOMPONENT @20 
REQUIRE_PREDICATE (GAME_IS ~bgee bg2ee eet iwdee~) @8

COPY ~faiths_and_powers/lib/markers/d5_marker.d5~ ~override/d5__spheres.d5~
COPY ~faiths_and_powers/lib/markers/d5_marker.d5~ ~override/d5__v_plus_spheres.d5~

ACTION_IF (FILE_EXISTS_IN_GAME ~fnp_sphere_list.tpa~) BEGIN
  MOVE ~override/fnp_sphere_list.tpa~ ~weidu_external/faiths_and_powers/fnp_sphere_list_old.tpa~
END

//prep sphere system________________________________________________________________
//
COPY ~faiths_and_powers/data/sphere_systems/sphere_list_vplus.tpa~ ~override/fnp_sphere_list.tpa~

//change shaman known spells________________________________________________________
//
//LAF shaman_spells END
//... nope, fold this into the d5_spontaneous function

//Add IWD and new spells____________________________________________________________
//
LAM d5_spell_options

ACTION_CLEAR_ARRAY aoe_spell

ACTION_IF (include_new_FNP_spells = 1) BEGIN
  INCLUDE ~faiths_and_powers/lib/spells_new_v75.tpa~      	//includes spells from the 0.75 series  
  INCLUDE ~faiths_and_powers/lib/spells_new_fnp.tpa~   		//new spells from the 0.77 series 
//  LAM v75_add_fnP_new_spells
  LAM v78_add_FnP_new_spells
END

/*
ACTION_IF !(GAME_IS ~iwdee~) BEGIN
  ACTION_IF (include_IWD_arcane_spells = 1) BEGIN
    LAM v75_add_iwd_arcane_spells
  END
  ACTION_IF (include_IWD_divine_spells = 1) BEGIN
    LAM v75_add_iwd_divine_spells
  END
END
*/

ACTION_IF (FILE_EXISTS_IN_GAME ~dvsrv4here.mrk~) BEGIN
  LAM v75_apply_sr_aoe_deflection
END  

LAF fix_spell_bams END

COPY ~faiths_and_powers/data/hlas/system_vplus/~ ~weidu_external/faiths_and_powers/hlas~

//INCLUDE ~%mod_folder%/lib/immunities.tpa~					//	DO AT THE VERY END OF ALL SPELL INSTALLS

//create sphere system______________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/system_spheres.tpa~

INCLUDE ~override/fnp_sphere_list.tpa~
 LAM define_sphere_names
 LAM d5_define_sphere_spells
 LAM d5_deity_kit_sphere_lists

COPY ~d5/d5spsph.2da~ ~override~

COPY_EXISTING_REGEXP ~^[Ss][Pp][Pp][Rr][1-7]\([0-4][0-9]\|50\)\.spl$~ ~override~
  PATCH_IF (%SOURCE_SIZE% > 0x71) BEGIN
    PATCH_IF !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR721~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR722~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR723~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR724~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR725~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR726~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR727~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR728~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR729~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR730~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR731~) AND !(~%SOURCE_RES%~ STRING_EQUAL_CASE ~SPPR732~) BEGIN
	  PATCH_IF !(FILE_CONTAINS_EVALUATED (~hidespl.2da~ ~%SOURCE_RES%~)) BEGIN
	    READ_SHORT 0x1c ~spelltype~
	    PATCH_IF (~spelltype~ = 2) BEGIN
	      READ_BYTE 0x21 exclude
	      PATCH_IF ((exclude BAND 0b11000000) = 0b10000000) BEGIN // valid for clerics
	        SPRINT $cleric_only_spells(~%SOURCE_RES%~)~1~
	      END
	      PATCH_IF ((exclude BAND 0b11000000) = 0b01000000) BEGIN // valid for druids
	        SPRINT $druid_only_spells(~%SOURCE_RES%~)~1~
	      END
	      PATCH_IF ((exclude BAND 0b11000000) = 0b00000000) BEGIN // valid for both
	        SPRINT $cleric_druid_spells(~%SOURCE_RES%~)~1~
	      END
	      PATCH_IF ((exclude BAND 0b11000000) = 0b11000000) BEGIN // valid for neither
	        SPRINT $shaman_only_spells(~%SOURCE_RES%~)~1~
	      END
	    END
	  END
	END
  END
BUT_ONLY

ACTION_PHP_EACH cleric_only_spells AS res => ind BEGIN
  APPEND ~d5spsph.2da~ ~%res%                 0	=	Cleric~
END
ACTION_PHP_EACH druid_only_spells AS res => ind BEGIN
  APPEND ~d5spsph.2da~ ~%res%                 0	=	Druid~
END
ACTION_PHP_EACH cleric_druid_spells AS res => ind BEGIN
  APPEND ~d5spsph.2da~ ~%res%                 0	=	Cleric~
  APPEND ~d5spsph.2da~ ~%res%                 0	=	Druid~
END

LAF prep_vanilla_spells END

LAF create_spheres END

//all HLAs for everyone_____________________________________________________________
//
COPY_EXISTING ~faiths_and_powers/data/hlas/system_vplus/luclxyz.2da~ ~override~
COPY_EXISTING ~faiths_and_powers/data/hlas/system_vplus/ludrxyz.2da~ ~override~
COPY_EXISTING ~faiths_and_powers/data/hlas/system_vplus/lufcxyz.2da~ ~override~
COPY_EXISTING ~faiths_and_powers/data/hlas/system_vplus/lucrxyz.2da~ ~override~
COPY_EXISTING ~faiths_and_powers/data/hlas/system_vplus/luctxyz.2da~ ~override~
COPY_EXISTING ~faiths_and_powers/data/hlas/system_vplus/lucmxyz.2da~ ~override~
//__________________________________________________________________________________



//__________________________________________________________________________________
//__________________________________________________________________________________

BEGIN @25 // new FnP sphere system - fewer spheres, more broadly balanced
DESIGNATED 25
SUBCOMPONENT @20 
REQUIRE_PREDICATE (GAME_IS ~bgee bg2ee eet iwdee~) @8

COPY ~faiths_and_powers/lib/markers/d5_marker.d5~ ~override/d5__spheres.d5~
COPY ~faiths_and_powers/lib/markers/d5_marker.d5~ ~override/d5__nu_fnp_spheres.d5~

ACTION_IF (FILE_EXISTS_IN_GAME ~fnp_sphere_list.tpa~) BEGIN
  MOVE ~override/fnp_sphere_list.tpa~ ~weidu_external/faiths_and_powers/fnp_sphere_list_old.tpa~
END

//prep sphere system________________________________________________________________
//
COPY ~faiths_and_powers/data/sphere_systems/sphere_list_new_fnp.tpa~ ~override/fnp_sphere_list.tpa~

//change shaman known spells________________________________________________________
//
//LAF shaman_spells END
//... nope, fold this into the d5_spontaneous function

//Add IWD and new spells____________________________________________________________
//
LAM d5_spell_options

ACTION_CLEAR_ARRAY aoe_spell

ACTION_IF (include_new_FNP_spells = 1) BEGIN
  INCLUDE ~faiths_and_powers/lib/spells_new_v75.tpa~      	//includes spells from the 0.75 series  
  INCLUDE ~faiths_and_powers/lib/spells_new_fnp.tpa~   		//new spells from the 0.77 series 
//  LAM v75_add_fnP_new_spells
  LAM v78_add_FnP_new_spells
END

ACTION_IF !(GAME_IS ~iwdee~) BEGIN
  ACTION_IF (include_IWD_arcane_spells = 1) BEGIN
    LAM v75_add_iwd_arcane_spells
  END
  ACTION_IF (include_IWD_divine_spells = 1) BEGIN
    LAM v75_add_iwd_divine_spells
  END
END

ACTION_IF (FILE_EXISTS_IN_GAME ~dvsrv4here.mrk~) BEGIN
  LAM v75_apply_sr_aoe_deflection
END  

LAF fix_spell_bams END

COPY ~faiths_and_powers/data/hlas/system_FnP_2/~ ~weidu_external/faiths_and_powers/hlas~

//INCLUDE ~%mod_folder%/lib/immunities.tpa~					//	DO AT THE VERY END OF ALL SPELL INSTALLS

INCLUDE ~faiths_and_powers/lib/system_spheres.tpa~

 LAF prep_vanilla_spells END

INCLUDE ~override/fnp_sphere_list.tpa~
 LAM define_sphere_names
 LAM d5_define_sphere_spells
 LAM d5_deity_kit_sphere_lists

LAF create_spheres END
//__________________________________________________________________________________




////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////


//__________________________________________________________________________________
//__________________________________________________________________________________
//
//							SPONTANEOUS CASTING OPTION
//__________________________________________________________________________________
//__________________________________________________________________________________


BEGIN @30 // install spont option
DESIGNATED 30
REQUIRE_PREDICATE (FILE_EXISTS_IN_GAME ~d5__spheres.d5~) @8
REQUIRE_PREDICATE !(FILE_EXISTS_IN_GAME ~d5__5E_casting_divine.d5~) @8


COPY ~faiths_and_powers/lib/markers/d5_marker.d5~ ~override/d5__fnp_spont_option.d5~
 

//__________________________________________________________________________________


////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////


//__________________________________________________________________________________
//__________________________________________________________________________________
//
//							INSTALL SINGLE-CLASS KITS
//__________________________________________________________________________________
//__________________________________________________________________________________

BEGIN @31 // install cleric kits
DESIGNATED 31

ACTION_IF (FILE_EXISTS_IN_GAME ~fnp_sphere_list.tpa~) BEGIN
  INCLUDE ~override/fnp_sphere_list.tpa~
END
INCLUDE ~faiths_and_powers/lib/kits_new_clerics.tpa~

ACTION_IF !(FILE_EXISTS_IN_GAME ~fnp_sphere_list.tpa~) BEGIN
  COPY ~faiths_and_powers/lib/markers/d5_marker.d5~ ~override/d5__no_spheres.d5~
END

OUTER_SPRINT symbols_name @154
LAF rename_holy_symbols STR_VAR item_name = EVAL ~%symbols_name%~ END

LAM d5_kit_choices

//LAM d5_spont_option

ACTION_IF (GAME_IS ~iwdee~) && (d5_cleric_kelemvor < 2) BEGIN
  OUTER_SET d5_cleric_kelemvor = 0
END
ACTION_IF (GAME_IS ~iwdee~) && (d5_cleric_cyric < 2) BEGIN
  OUTER_SET d5_cleric_cyric = 0
END

ACTION_IF (ENGINE_IS ~tob bgt~) BEGIN
   OUTER_SET d5_cleric_azuth	=	0
   OUTER_SET d5_cleric_mystra	=	0
   OUTER_SET d5_cleric_oghma	=	0
   OUTER_SET d5_cleric_baervan 	=	0
   OUTER_SET d5_cleric_arvoreen	=	0
   OUTER_SET d5_ur_priest	 	=	0
END

OUTER_SET cleric_umd = 0

// (clerics)
ACTION_IF (%d5_cleric_moradin% = 1) BEGIN
 LAF cleric_moradin END
END
ACTION_IF (%d5_cleric_clangeddin% = 1) BEGIN
 LAF cleric_clangeddin END
END
ACTION_IF (%d5_cleric_marthammor% = 1) BEGIN
 LAF cleric_marthammor END
END
ACTION_IF (%d5_cleric_baravar% = 1) BEGIN
 LAF cleric_baravar END
END
ACTION_IF (%d5_cleric_baervan% = 1) BEGIN
 LAF cleric_baervan END
END
ACTION_IF (%d5_cleric_urdlen% = 1) BEGIN
 LAF cleric_urdlen END
END
ACTION_IF (%d5_cleric_yondalla% = 1) BEGIN
 LAF cleric_yondalla END
END
ACTION_IF (%d5_cleric_arvoreen% = 1) BEGIN
 LAF cleric_arvoreen END
END
ACTION_IF (%d5_scion_bhaal% = 1) BEGIN
 LAF scion_bhaal END
 OUTER_SET cleric_umd = 1
END
ACTION_IF (%d5_cleric_azuth% = 1) BEGIN
 LAF cleric_azuth END
 OUTER_SET cleric_umd = 1
END
ACTION_IF (%d5_cleric_beshaba% = 1) BEGIN
 LAF cleric_beshaba END
END
ACTION_IF (%d5_cleric_cyric% = 1) BEGIN
  LAF cleric_cyric END
END
ACTION_IF (%d5_cleric_deneir% = 1) BEGIN
 LAF cleric_deneir END
END
ACTION_IF (%d5_cleric_helm% = 1) BEGIN
 LAF cleric_helm END
END
ACTION_IF (%d5_cleric_ilmater% = 1) BEGIN
 LAF cleric_ilmater END
END
ACTION_IF (%d5_cleric_kelemvor% = 1) BEGIN
  LAF cleric_kelemvor END
END
ACTION_IF (%d5_cleric_lathander% = 1) BEGIN
 LAF cleric_lathander END
END
ACTION_IF (%d5_cleric_leira% = 1) BEGIN
 LAF cleric_leira END
END
ACTION_IF (%d5_cleric_loviatar% = 1) BEGIN
 LAF cleric_loviatar END
END
ACTION_IF (%d5_cleric_malar% = 1) BEGIN
 LAF cleric_malar END
END
ACTION_IF (%d5_cleric_moander% = 1) BEGIN
 LAF cleric_moander END
END
ACTION_IF (%d5_cleric_mystra% = 1) BEGIN
 LAF cleric_mystra END
 OUTER_SET cleric_umd = 1
END
ACTION_IF (%d5_cleric_oghma% = 1) BEGIN
 LAF cleric_oghma END
 OUTER_SET cleric_umd = 1
END
ACTION_IF (%d5_cleric_shar% = 1) BEGIN
 LAF cleric_shar END
END
ACTION_IF (%d5_cleric_sune% = 1) BEGIN
 LAF cleric_sune END
END
ACTION_IF (%d5_cleric_talos% = 1) BEGIN
 LAF cleric_talos END
END
ACTION_IF (%d5_cleric_tempus% = 1) BEGIN
 LAF cleric_tempus END
END
ACTION_IF (%d5_priest_tempus% = 1) BEGIN
 LAF priest_tempus END
END
ACTION_IF (%d5_cleric_torm% = 1) BEGIN
 LAF cleric_torm END
END
ACTION_IF (%d5_cleric_tymora% = 1) BEGIN
 LAF cleric_tymora END
END
ACTION_IF (%d5_cleric_umberlee% = 1) BEGIN
 LAF cleric_umberlee END
END
//

// (ur-priest)
ACTION_IF (%d5_ur_priest% = 1) BEGIN
 LAF cleric_ur_priest END
END

LAF remove_sc_menu_kits STR_VAR class = ~C~ END

ACTION_IF	(ENGINE_IS ~tob bgt~) &&
			(MOD_IS_INSTALLED ~DIVINE_REMIX/SETUP-DIVINE_REMIX.TP2~ ~1000~) &&
			(FILE_EXISTS ~divine_remix/lib/macros.tph~) BEGIN
  INCLUDE ~faiths_and_powers/lib/kits_dr_compatibility.tpa~
  LAF cleric_dr_spheres END
END

ACTION_IF (cleric_umd = 1) BEGIN
  LAF clerics_use_magical_devices END
  LAF cleric_clabs_umd END
END


//__________________________________________________________________________________
//__________________________________________________________________________________
//
BEGIN @33 // install druid kits
DESIGNATED 33
REQUIRE_PREDICATE (GAME_IS ~bgee bg2ee eet iwdee~) @8

ACTION_IF (FILE_EXISTS_IN_GAME ~fnp_sphere_list.tpa~) BEGIN
  INCLUDE ~override/fnp_sphere_list.tpa~
END
INCLUDE ~faiths_and_powers/lib/kits_new_druids.tpa~

ACTION_IF !(FILE_EXISTS_IN_GAME ~fnp_sphere_list.tpa~) BEGIN
  COPY ~faiths_and_powers/lib/markers/d5_marker.d5~ ~override/d5__no_spheres.d5~
END

//change druid class text____________________________________________________________
//
LAF druid_class_text END
//__________________________________________________________________________________

//druids on cleric spell/xp tables__________________________________________________
//
LAF druid_xp END
//__________________________________________________________________________________

/*
//change shaman known spells________________________________________________________
//
ACTION_IF !(FILE_EXISTS_IN_GAME ~d5__no_spheres.d5)~) BEGIN
  LAF shaman_spells END
END
//__________________________________________________________________________________
*/

LAM d5_kit_choices

//LAM d5_spont_option

ACTION_IF (FILE_EXISTS_IN_GAME ~d5__no_spheres.d5~) BEGIN
   OUTER_SET d5_earth_mystic 	=	0
   OUTER_SET d5_water_mystic 	=	0
   OUTER_SET d5_air_mystic 		=	0
   OUTER_SET d5_fire_mystic 	=	0
   OUTER_SET d5_light_mystic 	=	0
   OUTER_SET d5_shadow_mystic 	=	0
   OUTER_SET d5_elementalist 	=	0
   OUTER_SET d5_hivekeeper_druid 	=	0
END

// (druids)
ACTION_IF (%d5_forest_druid% = 1) BEGIN
 LAF forest_druid END
END
ACTION_IF (%d5_totemic_druid% = 1) BEGIN
 LAF totemic_druid END
END
ACTION_IF (%d5_hivekeeper_druid% = 1) BEGIN
 LAF hivekeeper_druid END
END
ACTION_IF (%d5_northern_druid% = 1) BEGIN
 LAF northern_druid END
END
ACTION_IF (%d5_lost_druid% = 1) BEGIN
 LAF lost_druid END
END
ACTION_IF (%d5_forest_druid% + %d5_totemic_druid% + %d5_hivekeeper_druid% + %d5_northern_druid% + %d5_lost_druid% > 0) BEGIN
 LAF druid_shapeshifting END
END
ACTION_IF (%d5_beast_lord% = 1) BEGIN
 LAF beast_lord END
END
ACTION_IF (%d5_elementalist% = 1) BEGIN
 LAF elementalist END
END
ACTION_IF (%d5_earth_mystic% = 1) BEGIN
 LAF earth_mystic END
END
ACTION_IF (%d5_water_mystic% = 1) BEGIN
 LAF water_mystic END
END
ACTION_IF (%d5_air_mystic% = 1) BEGIN
 LAF air_mystic END
END
ACTION_IF (%d5_fire_mystic% = 1) BEGIN
 LAF fire_mystic END
END
ACTION_IF (%d5_light_mystic% = 1) BEGIN
 LAF light_mystic END
END
ACTION_IF (%d5_shadow_mystic% = 1) BEGIN
 LAF shadow_mystic END
END

LAF remove_sc_menu_kits STR_VAR class = ~D~ END

LAF clear_druid_clab END


//__________________________________________________________________________________
//__________________________________________________________________________________
//
BEGIN @35 // install paladin kits
DESIGNATED 35
REQUIRE_PREDICATE (GAME_IS ~bgee bg2ee eet iwdee~) @8

ACTION_IF (FILE_EXISTS_IN_GAME ~fnp_sphere_list.tpa~) BEGIN
  INCLUDE ~override/fnp_sphere_list.tpa~
END
INCLUDE ~faiths_and_powers/lib/kits_new_pladins.tpa~
INCLUDE ~faiths_and_powers/lib/kits_new_zealots.tpa~

ACTION_IF !(FILE_EXISTS_IN_GAME ~fnp_sphere_list.tpa~) BEGIN
  COPY ~faiths_and_powers/lib/markers/d5_marker.d5~ ~override/d5__no_spheres.d5~
END

//ranger/paladin spell tables_______________________________________________________
//
LAF paladin_spell_tables END
//__________________________________________________________________________________

LAM d5_kit_choices

//LAM d5_spont_option

ACTION_IF (FILE_EXISTS_IN_GAME ~d5__no_spheres.d5~) || (ENGINE_IS ~tob bgt~) BEGIN
   OUTER_SET d5_zealot_ilmater 		=	0
   OUTER_SET d5_zealot_corellon 	=	0
   OUTER_SET d5_zealot_sune 		=	0
   OUTER_SET d5_zealot_mystra 		=	0
   OUTER_SET d5_zealot_eilistraee 	=	0
   OUTER_SET d5_zealot_gruumsh 		=	0
   OUTER_SET d5_zealot_talos 		=	0
   OUTER_SET d5_zealot_kossuth 		=	0
   OUTER_SET d5_zealot_garagos 		=	0
END

LAF enable_more_paladins END

ACTION_IF (%d5_champion_moradin% = 1) BEGIN
 LAF champion_moradin END
END
ACTION_IF (%d5_champion_arvoreen% = 1) BEGIN
 LAF champion_arvoreen END
END
ACTION_IF (%d5_champion_azuth% = 1) BEGIN
 LAF champion_azuth	 END	//azuth essentially replaces Inquisitor
END
ACTION_IF (%d5_champion_bane% = 1) BEGIN
 ACTION_IF FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No Evil nonfallable pallys in IWDEE as yet
  LAF champion_bane END
 END
 ACTION_IF NOT FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No Evil nonfallable pallys in IWDEE as yet
  LAF iwdee_champion_bane END
 END
END
ACTION_IF (%d5_champion_helm% = 1) BEGIN
 ACTION_IF FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No Evil nonfallable pallys in IWDEE as yet
  LAF champion_helm END
 END
 ACTION_IF NOT FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No Evil fallable pallys in IWDEE
  LAF iwdee_champion_helm END
 END
END
ACTION_IF (%d5_champion_kelemvor% = 1) BEGIN
 //champ of Kele effectively replaces UHunter. In IWDEE, the champ of mykrul is merely added (they're different enough conceptually to be seperate)
 ACTION_IF GAME_IS ~iwdee~ THEN BEGIN   //
  LAF iwdee_champion_kelemvor END
 END
 //kelevmor undead hunter for non-iwdee
 ACTION_IF GAME_IS ~bgee bg2ee eet~ THEN BEGIN   //
  LAF champion_kelemvor END
 END
END
ACTION_IF (%d5_champion_red% = 1) BEGIN
 ACTION_IF FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No feasible way to make them not fall in IWDEE without fallen.2da
  LAF champion_red END
 END
END
ACTION_IF (%d5_champion_talos% = 1) BEGIN
 ACTION_IF FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No Evil nonfallable pallys in IWDEE
  LAF champion_talos END
 END
 ACTION_IF NOT FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No Evil nonfallable pallys in IWDEE
  LAF iwdee_champion_talos END
 END
END
ACTION_IF (%d5_champion_tempus% = 1) BEGIN
 ACTION_IF FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No feasible way to make them not fall in IWDEE as yet
  LAF champion_tempus END
 END
END
ACTION_IF (%d5_champion_tyr% = 1) BEGIN
 LAF champion_tyr END
END
//
// (other paladins)
//
// (zealot)
ACTION_IF (%d5_zealot_ilmater% + %d5_zealot_sune% + %d5_zealot_mystra% + %d5_zealot_eilistraee% + %d5_zealot_gruumsh% + %d5_zealot_talos% + %d5_zealot_kossuth% + %d5_zealot_garagos% > 0) BEGIN
 //sneaky sneaky
 COPY ~faiths_and_powers/kits/zealots/b_sneak.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk02.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk03.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk04.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk05.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk06.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk07.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk08.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk09.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk10.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk11.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk12.spl~ ~override~
 COPY ~faiths_and_powers/kits/zealots/b_snk13.spl~ ~override~
END

ACTION_IF (%d5_zealot_corellon% = 1) BEGIN
 LAF zealot_corellon END
END
ACTION_IF (%d5_zealot_eilistraee% = 1) BEGIN
 LAF zealot_eilistraee END
END
ACTION_IF FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No feasible way to make them not fall in IWDEE w/o fallen.2da
 ACTION_IF (%d5_zealot_gruumsh% = 1) BEGIN
  LAF zealot_gruumsh END
 END
END  //End grummsh
ACTION_IF (%d5_zealot_ilmater% = 1) BEGIN
 LAF zealot_ilmater END
END
ACTION_IF (%d5_zealot_mystra% = 1) BEGIN
 LAF zealot_mystra END
END
ACTION_IF (%d5_zealot_sune% = 1) BEGIN
 LAF zealot_sune END
END
ACTION_IF FILE_EXISTS_IN_GAME ~fallen.2da~ BEGIN  //No feasible way to make them not fall in IWDEE w/o fallen.2da
 ACTION_IF (%d5_zealot_garagos% = 1) BEGIN
  LAF zealot_garagos END
 END
 ACTION_IF (%d5_zealot_kossuth% = 1) BEGIN
  LAF zealot_kossuth END
 END
 ACTION_IF (%d5_zealot_talos% = 1) BEGIN
  LAF zealot_talos END
 END
END  //End talos/kossuth/garagos

LAF remove_sc_menu_kits STR_VAR class = ~P~ END


//__________________________________________________________________________________
//__________________________________________________________________________________
//
BEGIN @37 // install ranger kits
DESIGNATED 37
REQUIRE_PREDICATE (GAME_IS ~bgee bg2ee eet iwdee~) @8

ACTION_IF (FILE_EXISTS_IN_GAME ~fnp_sphere_list.tpa~) BEGIN
  INCLUDE ~override/fnp_sphere_list.tpa~
END
INCLUDE ~faiths_and_powers/lib/kits_new_rangers.tpa~

ACTION_IF !(FILE_EXISTS_IN_GAME ~fnp_sphere_list.tpa~) BEGIN
  COPY ~faiths_and_powers/lib/markers/d5_marker.d5~ ~override/d5__no_spheres.d5~
END

//ranger/paladin spell tables_______________________________________________________
//
LAF ranger_spell_tables END
//__________________________________________________________________________________

LAM d5_kit_choices

//LAM d5_spont_option

ACTION_IF (%d5_forest_ranger% = 1) BEGIN
 LAF forest_ranger END
END
ACTION_IF (%d5_mountain_ranger% = 1) BEGIN
 LAF mountain_ranger END
END
ACTION_IF (%d5_jungle_ranger% = 1) BEGIN
 LAF jungle_ranger END
END
ACTION_IF (%d5_desert_ranger% = 1) BEGIN
 LAF desert_ranger END
END
ACTION_IF (%d5_arctic_ranger% = 1) BEGIN
 LAF arctic_ranger END
END
ACTION_IF (%d5_beast_master% = 1) BEGIN
 LAF beast_master END
END
//
// (scouts)
ACTION_IF (%d5_mage_hunter% = 1) BEGIN
 LAF mage_hunter END
END
ACTION_IF (%d5_barbarian_ranger% = 1) BEGIN
 LAF barbarian_ranger END
END
ACTION_IF (%d5_elven_archer% = 1) BEGIN
 LAF elven_archer END
END

LAF remove_sc_menu_kits STR_VAR class = ~R~ END

//more scout alignments_____________________________________________________________
//
LAF more_ranger_alignments END
//__________________________________________________________________________________

//__________________________________________________________________________________
//__________________________________________________________________________________
//
//					              ADD SPELL SCROLLS FOR PRIESTS
//__________________________________________________________________________________
//__________________________________________________________________________________

//testing

BEGIN @70 // Add spell scrolls for priests
DESIGNATED 70

INCLUDE ~faiths_and_powers/data/components/Setup_Priest_Scrolls.tpa~


//test on vanilla (no reason I can think of it wouldn't work)


//__________________________________________________________________________________
//__________________________________________________________________________________
//
//					CHOOSE WHETHER TO CHANGE USABILITY/PROFICIENCY
//__________________________________________________________________________________
//__________________________________________________________________________________

BEGIN @75 // item usability
DESIGNATED 75
REQUIRE_PREDICATE (GAME_IS ~bgee bg2ee eet iwdee~) @8

COPY ~faiths_and_powers/lib/markers/d5_marker.d5~ ~override/d5__fnp_usability.d5~

INCLUDE ~faiths_and_powers/lib/qd_multiclass.tpa~

//read in kit functions_____________________________________________________________
//
ACTION_IF (FILE_EXISTS_IN_GAME ~fnp_sphere_list.tpa~) BEGIN
  INCLUDE ~override/fnp_sphere_list.tpa~
//  INCLUDE ~faiths_and_powers/lib/system_spheres.tpa~
  LAM define_sphere_names
  LAM d5_define_sphere_spells
  LAM d5_deity_kit_sphere_lists
END

INCLUDE ~faiths_and_powers/lib/kits_default_handling.tpa~
 LAF vanilla_kit_spheres END
 LAF mod_kit_spheres END
 LAF default_kit_spheres END
//__________________________________________________________________________________

//read system_base info in order to apply sphere system/item usability_______________
//
LAM ~READ_FNP_KIT_INFO~
//__________________________________________________________________________________

//alter item usability______________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/system_item_use.tpa~
 LAF change_usability END
 LAF apply_usability END
//__________________________________________________________________________________



////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////


//__________________________________________________________________________________
//__________________________________________________________________________________
//
//								APPLY SPHERE SYSTEM
//__________________________________________________________________________________
//__________________________________________________________________________________

BEGIN @80 // apply sphere systen
DESIGNATED 80
//INSTALL_BY_DEFAULT
REQUIRE_PREDICATE (GAME_IS ~bgee bg2ee eet iwdee~) @8
REQUIRE_PREDICATE (FILE_EXISTS_IN_GAME ~d5__spheres.d5~) @8
FORBID_COMPONENT ~faiths_and_powers.tp2~ ~29~ @8


//check sphere system_______________________________________________________________
//
ACTION_IF (FILE_EXISTS_IN_GAME ~clabpr01.2da~) && (FILE_EXISTS_IN_GAME ~fnp_sphere_list.tpa~) BEGIN
// INCLUDE ~faiths_and_powers/lib/system_spheres.tpa~
 INCLUDE ~override/fnp_sphere_list.tpa~
  LAM define_sphere_names
  LAM d5_define_sphere_spells
  LAM d5_deity_kit_sphere_lists
END
//__________________________________________________________________________________

//read in kit functions_____________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/kits_default_handling.tpa~
 LAF vanilla_kit_spheres END
 LAF mod_kit_spheres END
 LAF default_kit_spheres END
//__________________________________________________________________________________

//read system_base info in order to apply sphere system/item usability_______________
//
LAM ~READ_FNP_KIT_INFO~
//__________________________________________________________________________________

//Apply Sphere System_______________________________________________________________
//
 LAF apply_spheres END
//__________________________________________________________________________________

//universal spells available at CharGen_____________________________________________
//
//ACTION_IF !(FILE_EXISTS_IN_GAME ~d5__v_plus_spheres.d5~) BEGIN
 LAF universal_spells END
//END
//__________________________________________________________________________________

//universal spells available at CharGen_____________________________________________
//
ACTION_IF (FILE_EXISTS_IN_GAME ~d5__fnp_spont_option.d5~) BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5__spont_items_mem.d5~) BEGIN
    INCLUDE ~%MOD_FOLDER%/lib/semi_spontaneous.tpa~
    LAF divine_spont_items INT_VAR 5e_plus_mem = 1 END
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5__spont_items_no_mem.d5~) BEGIN
    INCLUDE ~%MOD_FOLDER%/lib/semi_spontaneous.tpa~
    LAF divine_spont_items INT_VAR 5e_plus_mem = 0 END
  END
END
//__________________________________________________________________________________

////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////


//__________________________________________________________________________________
//__________________________________________________________________________________
//
//						CHOOSE WHETHER TO CHANGE NPC KITS
//__________________________________________________________________________________
//__________________________________________________________________________________

BEGIN @85 // apply kits to NPCS
DESIGNATED 85
//INSTALL_BY_DEFAULT
REQUIRE_PREDICATE (MOD_IS_INSTALLED ~faiths_and_powers.tp2~ ~31~) OR (MOD_IS_INSTALLED ~faiths_and_powers.tp2~ ~33~) OR (MOD_IS_INSTALLED ~faiths_and_powers.tp2~ ~35~) OR (MOD_IS_INSTALLED ~faiths_and_powers.tp2~ ~37~)  @8


//read in kit functions_____________________________________________________________
//
INCLUDE ~faiths_and_powers/lib/system_npc_kits.tpa~
 LAF npc_sc_kits END
//__________________________________________________________________________________

